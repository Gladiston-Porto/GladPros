(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5575],{35695:(e,r,t)=>{"use strict";var s=t(18999);t.o(s,"useParams")&&t.d(r,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(r,{useSearchParams:function(){return s.useSearchParams}})},61821:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>o});var s=t(95155),a=t(66766),l=t(35695),i=t(12115);function n(){let e=(0,l.useRouter)(),r=(0,l.useSearchParams)(),t=null==r?void 0:r.get("userId"),n=(null==r?void 0:r.get("email"))||"",o=(null==r?void 0:r.get("name"))||"",c=(null==r?void 0:r.get("firstAccess"))==="true",[d,u]=(0,i.useState)(Array(6).fill("")),[m,x]=(0,i.useState)(!1),[h,f]=(0,i.useState)(!1),[g,p]=(0,i.useState)(null),[b,v]=(0,i.useState)(300),[j,y]=(0,i.useState)(!1),[N,w]=(0,i.useState)(null),S=(0,i.useRef)([]),C=(0,i.useRef)(!1);(0,i.useEffect)(()=>{if(!t)return void e.push("/login");let r=setInterval(()=>{v(e=>e<=1?(y(!0),0):e-1)},1e3);return()=>clearInterval(r)},[t,e]);let P=(0,i.useCallback)(async()=>{let r=d.join("");if(6!==r.length)return void p("Digite o c\xf3digo completo de 6 d\xedgitos");if(!m&&!h){f(!0),x(!0),p(null);try{let s=await fetch("/api/auth/mfa/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(t),code:r,tipoAcao:c?"PRIMEIRO_ACESSO":"LOGIN"})}),a=await s.json();if(!s.ok)throw Error(a.error||"C\xf3digo inv\xe1lido");a.requiresSetup&&a.redirectUrl?e.push(a.redirectUrl):e.push("/dashboard")}catch(e){var s;console.error("Erro na verifica\xe7\xe3o MFA:",e),p(e.message),u(Array(6).fill("")),null==(s=S.current[0])||s.focus(),C.current=!1,f(!1)}finally{x(!1)}}},[d,c,e,t,m,h]);(0,i.useEffect)(()=>{!d.every(e=>""!==e)||m||h||C.current||(C.current=!0,P())},[d,m,h,P]);let E=(e,r)=>{if(!/^\d*$/.test(r))return;let t=[...d];if(t[e]=r.slice(-1),u(t),r&&e<5){var s;null==(s=S.current[e+1])||s.focus()}},O=(e,r)=>{if("Backspace"===r.key&&!d[e]&&e>0){var t;null==(t=S.current[e-1])||t.focus()}},k=e=>{e.preventDefault();let r=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(6===r.length){var t;u(r.split("")),null==(t=S.current[5])||t.focus()}},D=async()=>{if(j){x(!0),p(null);try{var e;let r=await fetch("/api/auth/mfa/resend",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(t),tipoAcao:c?"PRIMEIRO_ACESSO":"LOGIN"})}),s=await r.json();if(!r.ok)throw Error(s.error||"Erro ao reenviar c\xf3digo");v(300),y(!1),u(Array(6).fill("")),null==(e=S.current[0])||e.focus(),w("Novo c\xf3digo enviado para seu email.")}catch(e){console.error("Erro ao reenviar:",e),p(e.message)}finally{x(!1)}}};return t?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-8",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)(a.default,{src:"/images/LOGO_300.png",alt:"GladPros",width:80,height:80,className:"mx-auto mb-4 rounded-lg"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Verifica\xe7\xe3o de Seguran\xe7a"}),(0,s.jsx)("p",{className:"text-gray-600 text-sm",children:c?"Digite o c\xf3digo enviado para finalizar o primeiro acesso":"Digite o c\xf3digo de verifica\xe7\xe3o enviado para seu email"})]}),(0,s.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-semibold text-lg",children:o.charAt(0).toUpperCase()})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-gray-800",children:o}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:n})]})]})}),(g||N)&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[g&&(0,s.jsx)("p",{className:"text-red-700 text-sm",children:g}),N&&(0,s.jsx)("p",{className:"text-green-700 text-sm",children:N})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"C\xf3digo de Verifica\xe7\xe3o"}),(0,s.jsx)("div",{className:"flex space-x-2 justify-center",children:d.map((e,r)=>(0,s.jsx)("input",{ref:e=>{S.current[r]=e},type:"text",value:e,onChange:e=>E(r,e.target.value),onKeyDown:e=>O(r,e),onPaste:k,className:"w-12 h-12 text-center text-xl font-semibold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none",maxLength:1,disabled:m||h},r))})]}),(0,s.jsx)("div",{className:"text-center mb-6",children:b>0?(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["C\xf3digo expira em: ",(0,s.jsx)("span",{className:"font-semibold text-blue-600",children:(e=>{let r=Math.floor(e/60);return"".concat(r,":").concat((e%60).toString().padStart(2,"0"))})(b)})]}):(0,s.jsx)("p",{className:"text-sm text-red-600",children:"C\xf3digo expirado. Solicite um novo c\xf3digo."})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("button",{onClick:P,disabled:h||m||d.some(e=>""===e)||0===b,className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-semibold flex items-center justify-center",children:[(m||h)&&(0,s.jsx)("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full mr-2"}),c?"Finalizar Primeiro Acesso":"Verificar e Entrar"]}),(0,s.jsx)("button",{onClick:D,disabled:!j||m,className:"w-full py-2 px-4 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Reenviar C\xf3digo"})]}),(0,s.jsx)("div",{className:"mt-8 pt-6 border-t",children:(0,s.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,s.jsx)("h4",{className:"font-semibold text-yellow-800 text-sm mb-2",children:"\uD83D\uDD12 Dicas de Seguran\xe7a:"}),(0,s.jsxs)("ul",{className:"text-sm text-yellow-700 space-y-1",children:[(0,s.jsx)("li",{children:"• O c\xf3digo tem 6 d\xedgitos e expira em 5 minutos"}),(0,s.jsx)("li",{children:"• Nunca compartilhe este c\xf3digo com ningu\xe9m"}),(0,s.jsx)("li",{children:"• Se n\xe3o solicitou, feche esta janela"})]})]})}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsx)("button",{onClick:()=>e.push("/login"),className:"text-sm text-gray-500 hover:text-gray-700 underline",children:"← Voltar para Login"})})]})}):(0,s.jsx)("div",{children:"Redirecionando..."})}function o(){return(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)("div",{children:"Carregando..."}),children:(0,s.jsx)(n,{})})}},75087:(e,r,t)=>{Promise.resolve().then(t.bind(t,61821))}},e=>{var r=r=>e(e.s=r);e.O(0,[6766,8441,1684,7358],()=>r(75087)),_N_E=e.O()}]);