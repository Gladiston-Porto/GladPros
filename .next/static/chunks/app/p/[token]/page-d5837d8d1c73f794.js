(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[791],{26126:(e,t,s)=>{"use strict";s.d(t,{E:()=>o});var a=s(95155);s(12115);var r=s(99708),i=s(74466),n=s(59434);let l=(0,i.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:s,asChild:i=!1,...o}=e,d=i?r.DX:"span";return(0,a.jsx)(d,{"data-slot":"badge",className:(0,n.cn)(l({variant:s}),t),...o})}},30285:(e,t,s)=>{"use strict";s.d(t,{$:()=>o,r:()=>l});var a=s(95155);s(12115);var r=s(99708),i=s(74466),n=s(59434);let l=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:s,size:i,asChild:o=!1,...d}=e,c=o?r.DX:"button";return(0,a.jsx)(c,{"data-slot":"button",className:(0,n.cn)(l({variant:s,size:i,className:t})),...d})}},42938:(e,t,s)=>{Promise.resolve().then(s.bind(s,50301))},50301:(e,t,s)=>{"use strict";s.d(t,{default:()=>C});var a=s(95155),r=s(12115),i=s(35695),n=s(66695),l=s(30285),o=s(59434);function d(e){let{className:t,type:s,...r}=e;return(0,a.jsx)("input",{type:s,"data-slot":"input",className:(0,o.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}var c=s(77484),u=s(5196);let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(c.bL,{ref:t,className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,a.jsx)(c.C1,{className:(0,o.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(u.A,{className:"h-4 w-4"})})})});m.displayName=c.bL.displayName;var h=s(26126);function x(e){let{onSignature:t,width:s=400,height:i=200,className:o=""}=e,d=(0,r.useRef)(null),[c,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=d.current;if(!e)return;let t=e.getContext("2d");t&&(t.strokeStyle="#000000",t.lineWidth=2,t.lineCap="round",t.lineJoin="round",t.fillStyle="#ffffff",t.fillRect(0,0,s,i))},[s,i]);let x=e=>{let t,s,a=d.current;if(!a)return;u(!0),h(!1);let r=a.getBoundingClientRect(),i=a.width/r.width,n=a.height/r.height;"touches"in e?(t=e.touches[0].clientX,s=e.touches[0].clientY):(t=e.clientX,s=e.clientY);let l=(t-r.left)*i,o=(s-r.top)*n,c=a.getContext("2d");c&&(c.beginPath(),c.moveTo(l,o))},g=e=>{let t,s;if(!c)return;let a=d.current;if(!a)return;let r=a.getContext("2d");if(!r)return;let i=a.getBoundingClientRect(),n=a.width/i.width,l=a.height/i.height;"touches"in e?(e.preventDefault(),t=e.touches[0].clientX,s=e.touches[0].clientY):(t=e.clientX,s=e.clientY);let o=(t-i.left)*n,u=(s-i.top)*l;r.lineTo(o,u),r.stroke()},f=()=>{if(u(!1),!m){let e=d.current;e&&t(e.toDataURL("image/png"))}};return(0,a.jsxs)(n.Zp,{className:o,children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Assinatura Digital"})}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-2",children:(0,a.jsx)("canvas",{ref:d,width:s,height:i,className:"border border-gray-200 rounded cursor-crosshair touch-none",style:{maxWidth:"100%",height:"auto"},onMouseDown:x,onMouseMove:g,onMouseUp:f,onMouseLeave:f,onTouchStart:x,onTouchMove:g,onTouchEnd:f})}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(l.$,{type:"button",variant:"outline",onClick:()=>{let e=d.current;if(!e)return;let a=e.getContext("2d");a&&(a.fillStyle="#ffffff",a.fillRect(0,0,s,i),h(!0),t(""))},disabled:m,children:"Limpar"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground self-center",children:m?"Assine no espa\xe7o acima":"Assinatura capturada"})]})]})]})}var g=s(26597),f=s(52699),p=s.n(f),v=s(91788);function b(e){let{elementId:t,filename:s="documento.pdf",disabled:i=!1,className:n="",children:o}=e,[d,c]=(0,r.useState)(!1),u=async()=>{try{c(!0);let e=document.getElementById(t);if(!e)throw Error("Elemento com ID '".concat(t,"' n\xe3o encontrado"));let a=await p()(e,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",removeContainer:!0,imageTimeout:1e4,logging:!1}),r=a.toDataURL("image/png"),i=new g.Ay({orientation:"portrait",unit:"mm",format:"a4"}),n=i.internal.pageSize.getWidth(),l=i.internal.pageSize.getHeight(),o=n-20,d=a.height*o/a.width,u=d,m=10;for(i.addImage(r,"PNG",10,m,o,d),u-=l-20;u>0;)m=u-d+10,i.addPage(),i.addImage(r,"PNG",10,m,o,d),u-=l-20;i.save(s)}catch(e){console.error("Erro ao gerar PDF:",e),alert("Erro ao gerar PDF. Tente novamente.")}finally{c(!1)}};return(0,a.jsx)(l.$,{onClick:u,disabled:i||d,className:n,variant:"outline",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"}),"Gerando PDF..."]}):(0,a.jsx)(a.Fragment,{children:o||(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Exportar PDF"]})})})}var j=s(93472),N=s(57434),y=s(23227),A=s(28883),w=s(55868),D=s(85339),E=s(40646);function C(e){var t,s,c;let{proposta:u,token:g}=e,[f,p]=(0,r.useState)(!1),[v,C]=(0,r.useState)(""),[S,k]=(0,r.useState)(!1),[R,P]=(0,r.useState)(""),I=(0,i.useRouter)();(0,r.useEffect)(()=>{u.cliente&&P(u.cliente.nome||"")},[u.cliente]);let U=async()=>{if(!v.trim()||!S||!R.trim())return void alert("Por favor, preencha todos os campos obrigat\xf3rios e assine.");try{p(!0);let e=await fetch("/api/client/proposta/".concat(g,"/sign"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assinaturaCliente:R,assinaturaImagem:v,aceiteTermos:S,ip:await Z(),userAgent:navigator.userAgent})});if(!e.ok){let t=await e.json();throw Error(t.message||"Erro ao assinar proposta")}alert("Proposta assinada com sucesso!"),I.refresh()}catch(e){console.error("Error signing proposal:",e),alert("Erro ao assinar proposta: "+(e instanceof Error?e.message:"Erro desconhecido"))}finally{p(!1)}},Z=async()=>{try{let e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch(e){return"unknown"}},O=u.status===j.f6.ENVIADA;return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 max-w-4xl",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsx)(N.A,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-foreground dark:text-white",children:"Proposta Comercial"}),(0,a.jsxs)("p",{className:"text-gray-600",children:[u.numeroProposta," \v ",(0,o.Yq)(u.createdAt)]})]})]}),(0,a.jsx)(h.E,{className:(e=>{switch(e){case j.f6.RASCUNHO:return"bg-gray-100 text-gray-800";case j.f6.ENVIADA:return"bg-blue-100 text-blue-800";case j.f6.ASSINADA:return"bg-green-100 text-green-800";case j.f6.APROVADA:return"bg-emerald-100 text-emerald-800";case j.f6.CANCELADA:return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(u.status),children:u.status})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)(b,{elementId:"proposta-content",filename:"proposta-".concat(u.numeroProposta,".pdf"),className:"hidden print:hidden",children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Baixar PDF"]})})]}),(0,a.jsxs)("div",{id:"proposta-content",children:[(0,a.jsxs)(n.Zp,{className:"mb-6",children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(y.A,{className:"h-5 w-5"}),"Informa\xe7\xf5es do Cliente"]})}),(0,a.jsx)(n.Wu,{children:(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"font-semibold",children:null==(t=u.cliente)?void 0:t.nome})}),(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(A.A,{className:"h-4 w-4 text-gray-500"}),(0,a.jsx)("span",{children:null==(s=u.cliente)?void 0:s.email})]})})]})})]}),(0,a.jsxs)(n.Zp,{className:"mb-6",children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Detalhes da Proposta"})}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"Descri\xe7\xe3o"}),(0,a.jsx)("p",{children:u.descricao}),u.detalhes&&(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:u.detalhes})]}),u.valorEstimado&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[(0,a.jsx)(w.A,{className:"h-4 w-4"}),"Valor Estimado"]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:(0,o.vv)(u.valorEstimado)})]}),"SIM"===u.permite&&u.quaisPermites&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[(0,a.jsx)(D.A,{className:"h-4 w-4 text-yellow-500"}),"Permites Necess\xe1rios"]}),(0,a.jsx)("p",{children:u.quaisPermites})]})]})]}),u.etapas&&u.etapas.length>0&&(0,a.jsxs)(n.Zp,{className:"mb-6",children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Etapas do Trabalho"})}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)("div",{className:"space-y-4",children:u.etapas.map((e,t)=>(0,a.jsx)("div",{className:"border-l-4 border-l-blue-500 pl-4",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold",children:[t+1,". ",e.titulo]}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:e.descricao})]}),(0,a.jsx)(h.E,{variant:"outline",children:e.status})]})},e.id))})})]}),u.materiais&&u.materiais.length>0&&(0,a.jsxs)(n.Zp,{className:"mb-6",children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Lista de Materiais"})}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"text-left py-2",children:"Item"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Quantidade"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Unidade"}),(null==(c=u.materiais)?void 0:c.some(e=>e.valorUnitario))&&(0,a.jsx)("th",{className:"text-right py-2",children:"Valor Unit."})]})}),(0,a.jsx)("tbody",{children:u.materiais.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"py-2",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.nome}),e.descricao&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.descricao})]})}),(0,a.jsx)("td",{className:"py-2",children:e.quantidade}),(0,a.jsx)("td",{className:"py-2",children:e.unidade}),(null==(t=u.materiais)?void 0:t.some(e=>e.valorUnitario))&&(0,a.jsx)("td",{className:"py-2 text-right",children:e.valorUnitario?(0,o.vv)(e.valorUnitario):"-"})]},e.id)})})]})})})]}),O&&(0,a.jsxs)(n.Zp,{className:"mb-6",children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(E.A,{className:"h-5 w-5 text-green-600"}),"Assinatura Digital"]})}),(0,a.jsxs)(n.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Nome do Respons\xe1vel *"}),(0,a.jsx)(d,{value:R,onChange:e=>P(e.target.value),placeholder:"Digite seu nome completo",required:!0})]}),(0,a.jsx)(x,{onSignature:C,width:600,height:200,className:"w-full"}),(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(m,{id:"terms",checked:S,onCheckedChange:e=>k(e)}),(0,a.jsx)("label",{htmlFor:"terms",className:"text-sm leading-relaxed cursor-pointer",children:"Declaro que li, entendi e aceito todos os termos e condi\xe7\xf5es desta proposta comercial. Confirmo que tenho autoridade para assinar em nome da empresa/pessoa mencionada."})]}),(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsx)(l.$,{onClick:U,disabled:f||!v||!S||!R.trim(),className:"w-full",size:"lg",children:f?"Processando...":"Assinar Proposta"})})]})]}),u.status===j.f6.ASSINADA&&u.assinadaEm&&(0,a.jsx)(n.Zp,{className:"mb-6",children:(0,a.jsx)(n.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(E.A,{className:"h-16 w-16 text-green-600 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-green-800 mb-2",children:"Proposta Assinada"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Esta proposta foi assinada em ",(0,o.Yq)(u.assinadaEm)]}),"+                ",u.assinaturaResponsavel&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Assinado por: ",u.assinaturaResponsavel]})]})})}),(0,a.jsxs)("div",{className:"text-center text-gray-500 text-sm",children:[(0,a.jsx)("p",{children:"GladPros - Sistema de Gest\xe3o de Propostas"}),(0,a.jsxs)("p",{children:["Este documento foi gerado automaticamente em ",(0,o.Yq)(new Date)]})]})]})," "]})})}},59434:(e,t,s)=>{"use strict";s.d(t,{Yq:()=>l,cn:()=>i,vv:()=>n});var a=s(52596),r=s(39688);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}function n(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}function l(e){return new Date(e).toLocaleDateString("pt-BR")}},66695:(e,t,s)=>{"use strict";s.d(t,{Wu:()=>o,ZB:()=>l,Zp:()=>i,aR:()=>n});var a=s(95155);s(12115);var r=s(59434);function i(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function l(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...s})}function o(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...s})}},93472:(e,t,s)=>{"use strict";s.d(t,{Ez:()=>i,Zt:()=>r,f6:()=>a});var a=function(e){return e.RASCUNHO="RASCUNHO",e.ENVIADA="ENVIADA",e.ASSINADA="ASSINADA",e.APROVADA="APROVADA",e.CANCELADA="CANCELADA",e}({});let r={RASCUNHO:"Rascunho",ENVIADA:"Enviada",ASSINADA:"Assinada",APROVADA:"Aprovada",CANCELADA:"Cancelada"},i={RASCUNHO:"bg-gray-100 text-gray-800",ENVIADA:"bg-blue-100 text-blue-800",ASSINADA:"bg-yellow-100 text-yellow-800",APROVADA:"bg-green-100 text-green-800",CANCELADA:"bg-red-100 text-red-800"}}},e=>{var t=t=>e(e.s=t);e.O(0,[3930,4316,6648,3860,8441,1684,7358],()=>t(42938)),_N_E=e.O()}]);