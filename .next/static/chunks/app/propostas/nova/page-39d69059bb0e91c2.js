(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2535],{8507:(e,a,s)=>{"use strict";s.d(a,{ClientesProvider:()=>o,n:()=>n});var r=s(95155),t=s(12115);let i=(0,t.createContext)(void 0);function o(e){let{children:a}=e,[s,o]=(0,t.useState)([]),[n,l]=(0,t.useState)(!0),[d,c]=(0,t.useState)(null),u=async()=>{try{l(!0),c(null);let e=await fetch("/api/clientes?limit=1000");if(!e.ok)throw Error("Erro ao carregar clientes");let a=await e.json();o(a.clientes||[])}catch(e){c(e instanceof Error?e.message:"Erro desconhecido"),console.error("Erro ao carregar clientes:",e)}finally{l(!1)}};return(0,t.useEffect)(()=>{u()},[]),(0,r.jsx)(i.Provider,{value:{clientes:s,loading:n,error:d,refetch:()=>{u()}},children:a})}function n(){let e=(0,t.useContext)(i);if(void 0===e)throw Error("useClientes must be used within a ClientesProvider");return e}},9050:(e,a,s)=>{"use strict";s.d(a,{default:()=>b});var r=s(95155),t=s(12115),i=s(35695),o=s(48648),n=s(16447),l=s(8507),d=s(95725),c=s(5604);let u=c.Ik({id:c.Yj(),codigo:c.Yj().min(1,"C\xf3digo obrigat\xf3rio"),nome:c.Yj().min(1,"Nome obrigat\xf3rio"),quantidade:c.ai().min(0,"Quantidade deve ser positiva"),unidade:c.Yj().min(1,"Unidade obrigat\xf3ria"),preco:c.ai().optional(),status:c.k5(["necessario","opcional","substituivel"]),fornecedor:c.Yj().optional(),obs:c.Yj().optional()}),m=c.Ik({id:c.Yj(),servico:c.Yj().min(1,"Servi\xe7o obrigat\xf3rio"),descricao:c.Yj().min(1,"Descri\xe7\xe3o obrigat\xf3ria"),quantidade:c.ai().optional(),unidade:c.Yj().optional(),duracaoHoras:c.ai().optional(),custoMO:c.ai().optional(),status:c.k5(["planejada","opcional","removida"])}),x=c.Ik({id:c.Yj().min(1,"Cliente obrigat\xf3rio"),contato_nome:c.Yj().min(1,"Nome do contato obrigat\xf3rio"),contato_email:c.Yj().email("E-mail inv\xe1lido"),contato_telefone:c.Yj().optional(),local_endereco:c.Yj().min(1,"Endere\xe7o obrigat\xf3rio"),titulo:c.Yj().min(1,"T\xedtulo obrigat\xf3rio")}),p=c.Ik({tempo_para_aceite:c.ai().min(1,"Tempo para aceite deve ser positivo"),validade_proposta:c.Yj().min(1,"Validade obrigat\xf3ria"),prazo_execucao_dias:c.ai().min(1,"Prazo de execu\xe7\xe3o deve ser positivo"),janela:c.Yj().optional(),restricoes:c.Yj().optional()}),h=c.Ik({condicoes_pagamento:c.Yj().min(1,"Condi\xe7\xf5es de pagamento obrigat\xf3rias"),garantia:c.Yj().min(1,"Garantia obrigat\xf3ria"),exclusoes:c.Yj().min(1,"Exclus\xf5es obrigat\xf3rias"),condicoes_gerais:c.Yj().min(1,"Condi\xe7\xf5es gerais obrigat\xf3rias"),desconto:c.ai().min(0).max(100,"Desconto deve estar entre 0 e 100%")}),g=c.Ik({custo_material:c.ai().min(0),custo_mo:c.ai().min(0),horas_mo:c.ai().min(0),custo_terceiros:c.ai().min(0),overhead_pct:c.ai().min(0).max(100),margem_pct:c.ai().min(0).max(100),impostos_pct:c.ai().min(0).max(100),contingencia_pct:c.ai().min(0).max(100),frete:c.ai().min(0)}),j=c.Ik({gatilho:c.k5(["na_aprovacao","por_marcos","na_entrega","custom"]),percentual_sinal:c.ai().min(0).max(100),forma_preferida:c.Yj().min(1,"Forma de pagamento obrigat\xf3ria"),instrucoes:c.Yj().optional()}),v=c.Ik({cliente:x,escopo:c.Yj().min(10,"Escopo deve ter pelo menos 10 caracteres"),prazos:p,permite:c.k5(["NECESSARIO","NAO_NECESSARIO","OBTIDO"]),quaisPermites:c.Yj().optional(),normas:c.Yj().optional(),inspecoes:c.Yj().optional(),materiais:c.YO(u),etapas:c.YO(m),comerciais:h,interno:g,faturamento:j,obsCliente:c.Yj().optional(),obsInternas:c.Yj().optional(),status:c.k5(["RASCUNHO","PENDENTE_APROVACAO","APROVADA","REJEITADA","CANCELADA","ENVIADA","ASSINADA"])});function b(){let[e,a]=(0,t.useState)(!1),[s,c]=(0,t.useState)("idle"),[u,m]=(0,t.useState)(o.f6.RASCUNHO),x=(0,i.useRouter)(),{showToast:p}=(0,n.d)(),{clientes:h,loading:g,error:j}=(0,l.n)(),[b,N]=(0,t.useState)({id:"",contato_nome:"",contato_email:"",contato_telefone:"",local_endereco:"",titulo:""}),[f,C]=(0,t.useState)(""),[_,w]=(0,t.useState)({tempo_para_aceite:7,validade_proposta:"",prazo_execucao_dias:5,janela:"",restricoes:""}),[y,A]=(0,t.useState)(o.Do.NAO_NECESSARIO),[E,k]=(0,t.useState)(""),[S,O]=(0,t.useState)(""),[U,J]=(0,t.useState)(""),[D,P]=(0,t.useState)({condicoes_pagamento:"40% na aprova\xe7\xe3o, 40% ap\xf3s etapa X, 20% na entrega",garantia:"12 meses m\xe3o de obra; 3 meses materiais",exclusoes:"Demoli\xe7\xf5es estruturais, pintura externa, taxas municipais",condicoes_gerais:"Servi\xe7os conforme normas; atrasos por clima n\xe3o imput\xe1veis; SLA 48h.",desconto:0}),[R,T]=(0,t.useState)({custo_material:0,custo_mo:0,horas_mo:0,custo_terceiros:0,overhead_pct:12,margem_pct:20,impostos_pct:0,contingencia_pct:0,frete:0}),[I,q]=(0,t.useState)([{id:crypto.randomUUID(),codigo:"CABO-14AWG",nome:"Cabo 14 AWG",quantidade:120,unidade:"m",preco:.35,status:"necessario"}]),[M,Y]=(0,t.useState)([{id:crypto.randomUUID(),servico:"Instala\xe7\xe3o de QDC",descricao:"Montagem e organiza\xe7\xe3o de circuitos.",quantidade:1,unidade:"servi\xe7o",duracaoHoras:8,custoMO:250,status:"planejada"}]),[L,G]=(0,t.useState)({gatilho:"na_aprovacao",percentual_sinal:40,forma_preferida:"Invoice",instrucoes:"Pagamento via invoice at\xe9 3 dias ap\xf3s emiss\xe3o."}),[V,z]=(0,t.useState)(""),[B,H]=(0,t.useState)("");(0,t.useEffect)(()=>{j&&p({title:"Erro",message:"Erro ao carregar lista de clientes",type:"error"})},[j,p]);let F=(0,t.useMemo)(()=>{let e=I.reduce((e,a)=>e+(a.preco?a.preco*(a.quantidade||0):0),0)||0,a=R.custo_mo||0,s=R.custo_terceiros||0,r=R.frete||0,t=e+a+s+r,i=t*(Number(R.overhead_pct||0)/100),o=(t+i)*(Number(R.margem_pct||0)/100),n=(t+i+o)*(Number(R.contingencia_pct||0)/100),l=t+i+o+n,d=l*(Number(R.impostos_pct||0)/100);return{mat:e,mo:a,terce:s,frete:r,overhead:i,margem:o,conting:n,impostos:d,precoCliente:l+d}},[I,R]),W=(0,t.useMemo)(()=>({cliente:b,escopo:f,prazos:_,permite:y,quaisPermites:E,normas:S,inspecoes:U,materiais:I,etapas:M,comerciais:D,interno:R,faturamento:L,obsCliente:V,obsInternas:B,status:u}),[b,f,_,y,E,S,U,I,M,D,R,L,V,B,u]),{debouncedSave:Q}=function(e){let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=(0,t.useRef)(null),r=(0,t.useRef)(""),i=(0,t.useCallback)(async e=>{try{let a={...e,status:"RASCUNHO"};(await fetch("/api/propostas/rascunho",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok}catch(e){}},[]),o=(0,t.useCallback)(e=>{if(!a)return;let t=JSON.stringify(e);t!==r.current&&(s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{r.current=t,i(e)},3e3))},[a,i]);return(0,t.useEffect)(()=>()=>{s.current&&clearTimeout(s.current)},[]),{saveRascunho:i,debouncedSave:o}}(W,!e);(0,t.useEffect)(()=>{b.id&&f.length>5&&Q(W)},[W,Q,b,f]);let X=e=>q(a=>a.filter(a=>a.id!==e)),Z=e=>Y(a=>a.filter(a=>a.id!==e)),$=e=>{let a=h.find(a=>a.id===e);a&&N(s=>({...s,id:e,contato_nome:a.nomeCompleto||a.razaoSocial||a.nomeFantasia||"",contato_email:a.email,contato_telefone:a.telefone||""}))},K=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];c("saving"),a(!0);try{let a=v.parse(W),r=await fetch("/api/propostas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(r.ok){var s;let a=await r.json();c("saved"),p({title:"Sucesso",message:e?"Rascunho salvo com sucesso!":"Proposta criada com sucesso!",type:"success"}),!e&&(null==(s=a.proposta)?void 0:s.id)&&x.push("/propostas/".concat(a.proposta.id))}else{let e=await r.json();throw Error(e.message||"Erro ao salvar proposta")}}catch(e){c("error"),console.error("Erro ao salvar:",e),p({title:"Erro",message:e instanceof Error?e.message:"Erro ao salvar proposta",type:"error"})}finally{a(!1),setTimeout(()=>c("idle"),3e3)}},ee={"--gp-blue":d.gp.blue,"--gp-orange":d.gp.orange},ea=u===o.f6.PENDENTE_APROVACAO?"orange":u===o.f6.APROVADA?"green":"red",es=u===o.f6.RASCUNHO?"Rascunho":u===o.f6.PENDENTE_APROVACAO?"Aguardando":u===o.f6.APROVADA?"Aprovada":"Cancelada";return(0,r.jsxs)("div",{style:ee,className:"min-h-screen bg-slate-50 dark:bg-transparent",children:[(0,r.jsxs)("div",{className:"mx-auto max-w-8xl px-6 py-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"font-title text-xl",children:"Proposta"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:"Preencha os campos para gerar uma proposta completa e profissional."})]}),(0,r.jsxs)("div",{className:"mt-3 flex justify-end items-center gap-3",children:[u===o.f6.RASCUNHO&&(0,r.jsx)("div",{className:"hidden sm:flex items-center rounded-lg bg-yellow-50 px-3 py-1 text-xs font-medium text-yellow-800 dark:bg-yellow-900/30",children:"Rascunho"}),"saving"===s&&(0,r.jsx)("span",{className:"text-xs text-slate-500",children:"Salvando…"}),"saved"===s&&(0,r.jsx)("span",{className:"text-xs text-emerald-600",children:"✓ Salvo"}),"error"===s&&(0,r.jsx)("span",{className:"text-xs text-red-600",children:"✗ Erro"}),(0,r.jsx)("button",{onClick:()=>K(!0),disabled:e||g,className:"rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-white/5 px-4 py-2 text-sm font-medium text-slate-700 dark:text-white shadow-sm hover:bg-slate-50 disabled:opacity-50",children:e?"Salvando...":"Salvar rascunho"}),(0,r.jsx)("button",{onClick:()=>K(!1),disabled:e||g,className:"rounded-xl bg-[var(--gp-blue)] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:opacity-95 disabled:opacity-50",children:e?"Criando...":"Criar Proposta"})]})]}),(0,r.jsxs)("main",{className:"mx-auto grid max-w-8xl grid-cols-1 gap-6 px-6 py-6 lg:grid-cols-4",children:[(0,r.jsxs)("div",{className:"order-2 flex flex-col gap-6 lg:order-1 lg:col-span-3",children:[(0,r.jsx)(d.wn,{title:"Dados Cadastrais",subtitle:"Dados do cliente e do local de execu\xe7\xe3o.",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Cliente"}),g?(0,r.jsxs)("div",{className:"flex items-center gap-2 rounded-xl border border-slate-200 bg-slate-50 px-3 py-2",children:[(0,r.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border border-slate-400 border-t-transparent"}),(0,r.jsx)("span",{className:"text-sm text-slate-500",children:"Carregando clientes..."})]}):(0,r.jsxs)(d.l6,{value:b.id,onChange:e=>$(e.target.value),disabled:g,children:[(0,r.jsx)("option",{value:"",children:"Selecionar cliente…"}),h.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.nomeCompleto||e.razaoSocial||e.nomeFantasia," - ",e.email]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"T\xedtulo"}),(0,r.jsx)(d.pd,{placeholder:"Reforma el\xe9trica apto 12B",value:b.titulo,onChange:e=>N({...b,titulo:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Contato – Nome"}),(0,r.jsx)(d.pd,{value:b.contato_nome,onChange:e=>N({...b,contato_nome:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Contato – E‑mail"}),(0,r.jsx)(d.pd,{type:"email",value:b.contato_email,onChange:e=>N({...b,contato_email:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Contato – Telefone"}),(0,r.jsx)(d.pd,{value:b.contato_telefone,onChange:e=>N({...b,contato_telefone:e.target.value})})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)(d.JU,{required:!0,children:"Endere\xe7o de execu\xe7\xe3o"}),(0,r.jsx)(d.pd,{placeholder:"Rua, n\xba, cidade, estado, CEP",value:b.local_endereco,onChange:e=>N({...b,local_endereco:e.target.value})})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)(d.JU,{required:!0,children:"Escopo (resumo)"}),(0,r.jsx)(d.TM,{placeholder:"Descreva o escopo geral do servi\xe7o…",value:f,onChange:e=>C(e.target.value)})]})]})}),(0,r.jsx)(d.wn,{title:"Prazos",subtitle:"Defina validade da proposta e prazos de execu\xe7\xe3o.",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Tempo para aceite (dias)"}),(0,r.jsx)(d.pd,{type:"number",value:_.tempo_para_aceite,onChange:e=>w({..._,tempo_para_aceite:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Validade da proposta"}),(0,r.jsx)(d.pd,{type:"date",value:_.validade_proposta,onChange:e=>w({..._,validade_proposta:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Prazo de execu\xe7\xe3o (dias)"}),(0,r.jsx)(d.pd,{type:"number",value:_.prazo_execucao_dias,onChange:e=>w({..._,prazo_execucao_dias:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Janela preferencial"}),(0,r.jsx)(d.pd,{placeholder:"Seg‑Sex, 8h–17h",value:_.janela,onChange:e=>w({..._,janela:e.target.value})})]}),(0,r.jsxs)("div",{className:"md:col-span-4",children:[(0,r.jsx)(d.JU,{children:"Restri\xe7\xf5es de acesso"}),(0,r.jsx)(d.TM,{placeholder:"Ex.: cadastro de visitantes, carga/descarga at\xe9 16h…",value:_.restricoes,onChange:e=>w({..._,restricoes:e.target.value})})]})]})}),(0,r.jsx)(d.wn,{title:"Permiss\xf5es / Conformidades",subtitle:"Permits, normas e inspe\xe7\xf5es.",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Permits necess\xe1rios?"}),(0,r.jsxs)(d.l6,{value:y,onChange:e=>A(e.target.value),children:[(0,r.jsx)("option",{value:o.Do.NAO_NECESSARIO,children:"N\xe3o"}),(0,r.jsx)("option",{value:o.Do.NECESSARIO,children:"Sim"})]})]}),(0,r.jsxs)("div",{className:"md:col-span-3",children:[(0,r.jsx)(d.JU,{className:y===o.Do.NECESSARIO?"":"opacity-50",children:"Quais permits"}),(0,r.jsx)(d.pd,{disabled:y!==o.Do.NECESSARIO,placeholder:"Ex.: El\xe9trica (City of Dallas)",value:E,onChange:e=>k(e.target.value)})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)(d.JU,{children:"Normas de refer\xeancia"}),(0,r.jsx)(d.pd,{placeholder:"NEC 2023, ABNT NBR 5410",value:S,onChange:e=>O(e.target.value)})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)(d.JU,{children:"Inspe\xe7\xf5es necess\xe1rias"}),(0,r.jsx)(d.pd,{placeholder:"Inspe\xe7\xe3o final el\xe9trica",value:U,onChange:e=>J(e.target.value)})]})]})}),(0,r.jsx)(d.wn,{title:"Materiais",subtitle:"Liste os materiais com quantidades e unidades.",children:(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[I.map(e=>{var a;return(0,r.jsxs)("div",{className:"grid grid-cols-12 items-end gap-2 rounded-xl border border-slate-200 bg-slate-50 dark:bg-transparent dark:border-white/10 p-3",children:[(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)(d.JU,{required:!0,children:"C\xf3digo"}),(0,r.jsx)(d.pd,{value:e.codigo,onChange:a=>q(s=>s.map(s=>s.id===e.id?{...s,codigo:a.target.value}:s))})]}),(0,r.jsxs)("div",{className:"col-span-3",children:[(0,r.jsx)(d.JU,{required:!0,children:"Nome"}),(0,r.jsx)(d.pd,{value:e.nome,onChange:a=>q(s=>s.map(s=>s.id===e.id?{...s,nome:a.target.value}:s))})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)(d.JU,{required:!0,children:"Quantidade"}),(0,r.jsx)(d.pd,{type:"number",value:e.quantidade,onChange:a=>q(s=>s.map(s=>s.id===e.id?{...s,quantidade:Number(a.target.value)}:s))})]}),(0,r.jsxs)("div",{className:"col-span-1",children:[(0,r.jsx)(d.JU,{required:!0,children:"Un"}),(0,r.jsx)(d.pd,{value:e.unidade,onChange:a=>q(s=>s.map(s=>s.id===e.id?{...s,unidade:a.target.value}:s))})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)(d.JU,{children:"Pre\xe7o unit. (interno)"}),(0,r.jsx)(d.pd,{type:"number",step:"0.01",value:null!=(a=e.preco)?a:"",onChange:a=>q(s=>s.map(s=>s.id===e.id?{...s,preco:Number(a.target.value)}:s))})]}),(0,r.jsx)("div",{className:"col-span-2 flex items-end justify-end gap-2",children:(0,r.jsx)("button",{onClick:()=>X(e.id),className:"rounded-lg border border-rose-200 bg-white dark:bg-white/5 px-3 py-2 text-xs font-medium text-rose-600 hover:bg-rose-50",children:"Remover"})})]},e.id)}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{onClick:()=>q(e=>[...e,{id:crypto.randomUUID(),codigo:"",nome:"",quantidade:1,unidade:"un",status:"necessario"}]),className:"rounded-xl bg-white dark:bg-white/5 px-4 py-2 text-sm font-medium text-[var(--gp-blue)] shadow-sm ring-1 ring-inset ring-slate-200 dark:ring-white/5 hover:bg-slate-50",children:"+ Adicionar material"})})]})}),(0,r.jsx)(d.wn,{title:"Etapas / Servi\xe7os",subtitle:"Descreva o que ser\xe1 executado e crit\xe9rios de aceite.",children:(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[M.map(e=>{var a,s,t,i;return(0,r.jsxs)("div",{className:"grid grid-cols-12 gap-2 rounded-xl border border-slate-200 bg-slate-50 dark:bg-transparent dark:border-white/10 p-3",children:[(0,r.jsxs)("div",{className:"col-span-3",children:[(0,r.jsx)(d.JU,{required:!0,children:"Servi\xe7o"}),(0,r.jsx)(d.pd,{value:e.servico,onChange:a=>Y(s=>s.map(s=>s.id===e.id?{...s,servico:a.target.value}:s))})]}),(0,r.jsxs)("div",{className:"col-span-5",children:[(0,r.jsx)(d.JU,{required:!0,children:"Descri\xe7\xe3o"}),(0,r.jsx)(d.TM,{rows:3,value:e.descricao,onChange:a=>Y(s=>s.map(s=>s.id===e.id?{...s,descricao:a.target.value}:s))})]}),(0,r.jsxs)("div",{className:"col-span-1",children:[(0,r.jsx)(d.JU,{children:"Qtd"}),(0,r.jsx)(d.pd,{type:"number",value:null!=(a=e.quantidade)?a:"",onChange:a=>Y(s=>s.map(s=>s.id===e.id?{...s,quantidade:Number(a.target.value)}:s))})]}),(0,r.jsxs)("div",{className:"col-span-1",children:[(0,r.jsx)(d.JU,{children:"Un"}),(0,r.jsx)(d.pd,{value:null!=(s=e.unidade)?s:"",onChange:a=>Y(s=>s.map(s=>s.id===e.id?{...s,unidade:a.target.value}:s))})]}),(0,r.jsxs)("div",{className:"col-span-1",children:[(0,r.jsx)(d.JU,{children:"Horas"}),(0,r.jsx)(d.pd,{type:"number",value:null!=(t=e.duracaoHoras)?t:"",onChange:a=>Y(s=>s.map(s=>s.id===e.id?{...s,duracaoHoras:Number(a.target.value)}:s))})]}),(0,r.jsxs)("div",{className:"col-span-1",children:[(0,r.jsx)(d.JU,{children:"Custo MO"}),(0,r.jsx)(d.pd,{type:"number",step:"0.01",value:null!=(i=e.custoMO)?i:"",onChange:a=>Y(s=>s.map(s=>s.id===e.id?{...s,custoMO:Number(a.target.value)}:s))})]}),(0,r.jsxs)("div",{className:"col-span-12 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(d.JU,{children:"Status"}),(0,r.jsxs)(d.l6,{value:e.status,onChange:a=>Y(s=>s.map(s=>s.id===e.id?{...s,status:a.target.value}:s)),className:"w-auto",children:[(0,r.jsx)("option",{value:"planejada",children:"Planejada"}),(0,r.jsx)("option",{value:"opcional",children:"Opcional"}),(0,r.jsx)("option",{value:"removida",children:"Removida"})]})]}),(0,r.jsx)("button",{onClick:()=>Z(e.id),className:"rounded-lg border border-rose-200 bg-white dark:bg-white/5 px-3 py-2 text-xs font-medium text-rose-600 hover:bg-rose-50",children:"Remover"})]})]},e.id)}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{onClick:()=>Y(e=>[...e,{id:crypto.randomUUID(),servico:"",descricao:"",quantidade:1,unidade:"servi\xe7o",status:"planejada"}]),className:"rounded-xl bg-white dark:bg-white/5 px-4 py-2 text-sm font-medium text-[var(--gp-blue)] shadow-sm ring-1 ring-inset ring-slate-200 dark:ring-white/5 hover:bg-slate-50",children:"+ Adicionar etapa"})})]})}),(0,r.jsx)(d.wn,{title:"Condi\xe7\xf5es Comerciais",subtitle:"Tudo que o cliente precisa saber para decidir.",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Condi\xe7\xf5es de pagamento"}),(0,r.jsx)(d.TM,{value:D.condicoes_pagamento,onChange:e=>P({...D,condicoes_pagamento:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Garantia"}),(0,r.jsx)(d.TM,{value:D.garantia,onChange:e=>P({...D,garantia:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Exclus\xf5es"}),(0,r.jsx)(d.TM,{value:D.exclusoes,onChange:e=>P({...D,exclusoes:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Condi\xe7\xf5es gerais"}),(0,r.jsx)(d.TM,{value:D.condicoes_gerais,onChange:e=>P({...D,condicoes_gerais:e.target.value})})]})]})}),(0,r.jsx)(d.wn,{title:"Faturamento / Invoice",subtitle:"Defina quando e como faturar.",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{required:!0,children:"Gatilho"}),(0,r.jsxs)(d.l6,{value:L.gatilho,onChange:e=>G({...L,gatilho:e.target.value}),children:[(0,r.jsx)("option",{value:"na_aprovacao",children:"Na aprova\xe7\xe3o"}),(0,r.jsx)("option",{value:"por_marcos",children:"Por marcos"}),(0,r.jsx)("option",{value:"na_entrega",children:"Na entrega"}),(0,r.jsx)("option",{value:"custom",children:"Custom"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"% sinal (se aplic\xe1vel)"}),(0,r.jsx)(d.pd,{type:"number",value:L.percentual_sinal,onChange:e=>G({...L,percentual_sinal:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Forma preferida"}),(0,r.jsxs)(d.l6,{value:L.forma_preferida,onChange:e=>G({...L,forma_preferida:e.target.value}),children:[(0,r.jsx)("option",{children:"Invoice"}),(0,r.jsx)("option",{children:"PIX/Zelle"}),(0,r.jsx)("option",{children:"Cart\xe3o"}),(0,r.jsx)("option",{children:"Transfer\xeancia"})]})]}),(0,r.jsxs)("div",{className:"md:col-span-4",children:[(0,r.jsx)(d.JU,{children:"Instru\xe7\xf5es"}),(0,r.jsx)(d.TM,{value:L.instrucoes,onChange:e=>G({...L,instrucoes:e.target.value})})]})]})}),(0,r.jsx)(d.wn,{title:"Observa\xe7\xf5es",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Observa\xe7\xf5es para o cliente (aparecem no PDF)"}),(0,r.jsx)(d.TM,{value:V,onChange:e=>z(e.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Observa\xe7\xf5es internas (n\xe3o aparecem no PDF)"}),(0,r.jsx)(d.TM,{value:B,onChange:e=>H(e.target.value)})]})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,r.jsx)("button",{onClick:()=>x.back(),className:"rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50",children:"Cancelar"}),(0,r.jsx)("button",{onClick:()=>K(!1),disabled:e,className:"rounded-xl bg-[var(--gp-blue)] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:opacity-95 disabled:opacity-50",children:e?"Salvando...":"Salvar e continuar"})]})]}),(0,r.jsxs)("div",{className:"order-1 flex flex-col gap-6 lg:order-2",children:[(0,r.jsxs)("section",{className:"rounded-2xl border border-slate-200 bg-white dark:bg-white/5 dark:border-white/10 p-5 shadow-sm",children:[(0,r.jsxs)("div",{className:"mb-3 flex items-start justify-between",children:[(0,r.jsx)("h3",{className:"text-base font-semibold text-slate-800",children:"Resumo de Pre\xe7o (interno)"}),(0,r.jsx)(d.Ex,{children:"Privado"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 text-sm",children:[(0,r.jsx)("span",{className:"text-slate-500",children:"Materiais"}),(0,r.jsx)("span",{className:"text-right font-medium",children:(0,d.Gl)(F.mat)})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 text-sm",children:[(0,r.jsx)("span",{className:"text-slate-500",children:"M\xe3o de obra"}),(0,r.jsx)("span",{className:"text-right font-medium",children:(0,d.Gl)(F.mo)})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 text-sm",children:[(0,r.jsx)("span",{className:"text-slate-500",children:"Terceiros"}),(0,r.jsx)("span",{className:"text-right font-medium",children:(0,d.Gl)(F.terce)})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 text-sm",children:[(0,r.jsx)("span",{className:"text-slate-500",children:"Frete/Log\xedstica"}),(0,r.jsx)("span",{className:"text-right font-medium",children:(0,d.Gl)(F.frete)})]}),(0,r.jsx)("hr",{className:"my-2"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 text-sm",children:[(0,r.jsx)("span",{className:"text-slate-500",children:"Overhead"}),(0,r.jsx)("span",{className:"text-right font-medium",children:(0,d.Gl)(F.overhead)})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 text-sm",children:[(0,r.jsx)("span",{className:"text-slate-500",children:"Margem"}),(0,r.jsx)("span",{className:"text-right font-medium",children:(0,d.Gl)(F.margem)})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 text-sm",children:[(0,r.jsx)("span",{className:"text-slate-500",children:"Conting\xeancia"}),(0,r.jsx)("span",{className:"text-right font-medium",children:(0,d.Gl)(F.conting)})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 text-sm",children:[(0,r.jsx)("span",{className:"text-slate-500",children:"Impostos"}),(0,r.jsx)("span",{className:"text-right font-medium",children:(0,d.Gl)(F.impostos)})]}),(0,r.jsx)("div",{className:"mt-3 rounded-xl bg-slate-50 dark:bg-transparent p-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsx)("span",{className:"font-semibold text-slate-700",children:"Pre\xe7o ao cliente (estimado)"}),(0,r.jsx)("span",{className:"text-base font-semibold text-slate-900",children:(0,d.Gl)(F.precoCliente)})]})})]}),(0,r.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-3 text-xs",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Overhead (%)"}),(0,r.jsx)(d.pd,{type:"number",value:R.overhead_pct,onChange:e=>T({...R,overhead_pct:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Margem (%)"}),(0,r.jsx)(d.pd,{type:"number",value:R.margem_pct,onChange:e=>T({...R,margem_pct:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Impostos (%)"}),(0,r.jsx)(d.pd,{type:"number",value:R.impostos_pct,onChange:e=>T({...R,impostos_pct:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Conting\xeancia (%)"}),(0,r.jsx)(d.pd,{type:"number",value:R.contingencia_pct,onChange:e=>T({...R,contingencia_pct:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Custo materiais"}),(0,r.jsx)(d.pd,{type:"number",step:"0.01",value:R.custo_material,onChange:e=>T({...R,custo_material:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Custo m\xe3o de obra"}),(0,r.jsx)(d.pd,{type:"number",step:"0.01",value:R.custo_mo,onChange:e=>T({...R,custo_mo:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Horas MO"}),(0,r.jsx)(d.pd,{type:"number",value:R.horas_mo,onChange:e=>T({...R,horas_mo:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Terceiros"}),(0,r.jsx)(d.pd,{type:"number",step:"0.01",value:R.custo_terceiros,onChange:e=>T({...R,custo_terceiros:Number(e.target.value)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.JU,{children:"Frete/Log"}),(0,r.jsx)(d.pd,{type:"number",step:"0.01",value:R.frete,onChange:e=>T({...R,frete:Number(e.target.value)})})]})]})]}),(0,r.jsx)(d.wn,{title:"Status da Proposta",subtitle:"Controle o estado atual da proposta.",children:(0,r.jsx)("div",{className:"grid grid-cols-1 gap-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:["Status atual: ",(0,r.jsx)(d.Ex,{color:ea,children:es})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>m(o.f6.APROVADA),className:"rounded-xl border border-emerald-200 bg-white dark:bg-white/5 px-3 py-2 text-xs font-semibold text-emerald-700 hover:bg-emerald-50",children:"Marcar aprovada"}),(0,r.jsx)("button",{onClick:()=>m(o.f6.CANCELADA),className:"rounded-xl border border-rose-200 bg-white dark:bg-white/5 px-3 py-2 text-xs font-semibold text-rose-700 hover:bg-rose-50",children:"Cancelar"})]})]})})})]})]}),(0,r.jsx)("footer",{className:"mx-auto max-w-7xl px-4 pb-10 pt-4 text-center text-xs text-slate-400",children:"Formul\xe1rio de proposta • GladPros • Sistema integrado"})]})}},16447:(e,a,s)=>{"use strict";s.d(a,{d:()=>t}),s(95155),s(12115);var r=s(64198);function t(){let e=(0,r.d)();return{showToast:a=>{let{title:s,message:r,type:t="info",duration:i}=a;if("number"==typeof i)return void e.addToast({title:null!=s?s:"",message:r,type:t,duration:i});switch(t){case"success":e.success(null!=s?s:"Sucesso",r);break;case"error":e.error(null!=s?s:"Erro",r);break;case"warning":e.warning(null!=s?s:"Aviso",r);break;default:e.info(null!=s?s:"",r)}}}}},48648:(e,a,s)=>{"use strict";s.d(a,{Do:()=>t,f6:()=>r});var r=function(e){return e.RASCUNHO="RASCUNHO",e.PENDENTE_APROVACAO="PENDENTE_APROVACAO",e.APROVADA="APROVADA",e.REJEITADA="REJEITADA",e.CANCELADA="CANCELADA",e.ENVIADA="ENVIADA",e.ASSINADA="ASSINADA",e}({}),t=function(e){return e.NECESSARIO="NECESSARIO",e.NAO_NECESSARIO="NAO_NECESSARIO",e.OBTIDO="OBTIDO",e}({})},64198:(e,a,s)=>{"use strict";s.d(a,{ToastContainer:()=>l,ToastProvider:()=>o,d:()=>n});var r=s(95155),t=s(12115);let i=(0,t.createContext)(void 0);function o(e){let{children:a}=e,[s,o]=(0,t.useState)([]),n=(0,t.useCallback)(e=>{o(a=>a.filter(a=>a.id!==e))},[]),l=(0,t.useCallback)(e=>{let a=Math.random().toString(36).substr(2,9),s={...e,id:a};o(e=>[...e,s]);let r=e.duration||5e3;r>0&&setTimeout(()=>{n(a)},r)},[n]),d=(0,t.useCallback)((e,a)=>{l({title:e,message:a,type:"success"})},[l]),c=(0,t.useCallback)((e,a)=>{l({title:e,message:a,type:"error",duration:0})},[l]),u=(0,t.useCallback)((e,a)=>{l({title:e,message:a,type:"warning"})},[l]),m=(0,t.useCallback)((e,a)=>{l({title:e,message:a,type:"info"})},[l]);return(0,r.jsx)(i.Provider,{value:{toasts:s,addToast:l,removeToast:n,success:d,error:c,warning:u,info:m},children:a})}function n(){let e=(0,t.useContext)(i);if(!e)throw Error("useToast must be used within a ToastProvider");return e}function l(){let{toasts:e,removeToast:a}=n();return 0===e.length?null:(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm",children:e.map(e=>(0,r.jsx)(d,{toast:e,onRemove:a},e.id))})}function d(e){let{toast:a,onRemove:s}=e,{type:t,title:i,message:o,action:n}=a;return(0,r.jsx)("div",{className:"".concat((()=>{switch(t){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}})()," border rounded-lg shadow-lg p-4 transform transition-all duration-300 ease-in-out animate-in slide-in-from-right"),children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(()=>{switch(t){case"success":return(0,r.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})});case"error":return(0,r.jsx)("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})});case"warning":return(0,r.jsx)("svg",{className:"w-5 h-5 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.936-.833-2.707 0L3.108 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"info":return(0,r.jsx)("svg",{className:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}})()}),(0,r.jsxs)("div",{className:"ml-3 flex-1",children:[(0,r.jsx)("h3",{className:"font-medium text-sm",children:i}),o&&(0,r.jsx)("p",{className:"mt-1 text-sm opacity-90",children:o}),n&&(0,r.jsx)("button",{onClick:n.onClick,className:"mt-2 text-sm font-medium underline hover:no-underline",children:n.label})]}),(0,r.jsx)("div",{className:"ml-4 flex-shrink-0",children:(0,r.jsx)("button",{onClick:()=>s(a.id),className:"inline-flex rounded-md p-1.5 hover:bg-black hover:bg-opacity-10 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-transparent focus:ring-current",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]})})}},88677:(e,a,s)=>{Promise.resolve().then(s.bind(s,53171)),Promise.resolve().then(s.bind(s,8507)),Promise.resolve().then(s.bind(s,9050))},95725:(e,a,s)=>{"use strict";s.d(a,{$n:()=>u,Ex:()=>c,Gl:()=>m,JU:()=>i,TM:()=>n,gp:()=>t,l6:()=>l,pd:()=>o,wn:()=>d});var r=s(95155);s(12115);let t={blue:"#0A2C52",orange:"#D6631C"},i=e=>{let{children:a,required:s,className:t}=e;return(0,r.jsxs)("label",{className:"block text-sm font-medium text-slate-700 ".concat(t||""),children:[a,s?(0,r.jsx)("span",{className:"text-red-500",children:" *"}):null]})},o=e=>{var a;return(0,r.jsx)("input",{...e,className:["w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm shadow-sm","focus:outline-none focus:ring-2 focus:ring-[var(--gp-orange)]",null!=(a=e.className)?a:""].join(" ")})},n=e=>{var a,s;return(0,r.jsx)("textarea",{rows:null!=(a=e.rows)?a:4,...e,className:["w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm shadow-sm","focus:outline-none focus:ring-2 focus:ring-[var(--gp-orange)]",null!=(s=e.className)?s:""].join(" ")})},l=e=>{var a;return(0,r.jsx)("select",{...e,className:["w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm shadow-sm","focus:outline-none focus:ring-2 focus:ring-[var(--gp-orange)]",null!=(a=e.className)?a:""].join(" ")})},d=e=>{let{title:a,subtitle:s,children:t,right:i}=e;return(0,r.jsxs)("section",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-base font-semibold text-slate-800",children:a}),s?(0,r.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:s}):null]}),i]}),t]})},c=e=>{let{children:a,color:s="slate"}=e;return(0,r.jsx)("span",{className:"inline-flex items-center rounded-full px-2.5 py-1 text-xs ".concat({slate:"bg-slate-100 text-slate-700",green:"bg-emerald-100 text-emerald-700",orange:"bg-amber-100 text-amber-700",red:"bg-rose-100 text-rose-700"}[s]),children:a})},u=e=>(0,r.jsx)("button",{...e,className:["inline-flex items-center justify-center rounded-xl px-4 py-2.5 text-sm font-semibold","bg-blue-600 text-white hover:bg-blue-700 focus:ring-4 focus:ring-blue-300","disabled:opacity-50 disabled:cursor-not-allowed","transition-colors duration-200",e.className||""].join(" ")});function m(e){return null==e||Number.isNaN(e)?"-":e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}}},e=>{var a=a=>e(e.s=a);e.O(0,[6766,6874,2186,5604,3171,8441,1684,7358],()=>a(88677)),_N_E=e.O()}]);