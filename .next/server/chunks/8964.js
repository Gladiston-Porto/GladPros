exports.id=8964,exports.ids=[8964],exports.modules={1440:(e,t,r)=>{"use strict";r.d(t,{M:()=>l});var s=r(44999),a=r(39916),n=r(48378),o=r(13641),i=r(29979);async function l(){let e=await (0,s.UL)(),t=e.get("authToken")?.value;if(!t)return(0,a.redirect)("/login");try{let e=await (0,n.S)(t),r=await o.z.$queryRaw`
      SELECT id, email, nomeCompleto, tokenVersion, status 
      FROM Usuario 
      WHERE id = ${Number(e.sub)} 
      LIMIT 1
    `;if(!r.length)return(0,a.redirect)("/login?e=user");let s=r[0];if(await (0,i.I)())try{let t=s.tokenVersion??0;if((e.tokenVersion??0)!==t)return(0,a.redirect)("/login?e=tokenver")}catch{}if("ATIVO"!==e.status||"ATIVO"!==s.status)return(0,a.redirect)("/login?e=inactive");return{id:String(e.sub),role:String(e.role??"USUARIO"),email:s.email||void 0,name:s.nomeCompleto||"Usu\xe1rio"}}catch{return(0,a.redirect)("/login?e=token")}}},13641:(e,t,r)=>{"use strict";r.d(t,{z:()=>s.z});var s=r(31183)},18678:(e,t,r)=>{Promise.resolve().then(r.bind(r,37099))},29979:(e,t,r)=>{"use strict";r.d(t,{I:()=>o});var s=r(13641);let a=null,n=0;async function o(){let e=Date.now();if(null!==a&&e-n<6e4)return a;try{let t=await s.z.$queryRaw`
      SELECT COUNT(*) AS cnt
      FROM INFORMATION_SCHEMA.COLUMNS
      WHERE TABLE_SCHEMA = DATABASE()
        AND TABLE_NAME = 'Usuario'
        AND COLUMN_NAME = 'tokenVersion'
    `;return a=(t?.[0]?.cnt??0)>0,n=e,a}catch{return a=!1,n=e,!1}}},31183:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var s=r(29942);let a=global.__prisma??new s.PrismaClient({log:["error"]})},37099:(e,t,r)=>{"use strict";r.d(t,{Panel:()=>I,default:()=>T});var s=r(60687),a=r(43210),n=r(30474),o=r(85814),i=r.n(o),l=r(16189),d=r(92576),c=r(88920),h=r(49625),p=r(41312),x=r(38038),m=r(10022),u=r(57800),g=r(19080),b=r(23928),f=r(99270),w=r(97051),v=r(363),j=r(21134),N=r(84027),y=r(14952),E=r(47033),A=r(40083),C=r(17727),k=r(14138);let _=[{href:"/dashboard",label:"Dashboard",icon:h.A},{href:"/clientes",label:"Clientes",icon:p.A},{href:"/usuarios",label:"Usu\xe1rios",icon:x.A},{href:"/propostas",label:"Propostas",icon:m.A},{href:"/projetos",label:"Projetos",icon:u.A},{href:"/estoque",label:"Estoque",icon:g.A},{href:"/financeiro",label:"Financeiro",icon:b.A}],S={ADMIN:{chip:"bg-[#3E4095] text-white",glow:"shadow-[0_0_0_3px_rgba(62,64,149,0.2)]"},GERENTE:{chip:"bg-[#0098DA] text-white",glow:"shadow-[0_0_0_3px_rgba(0,152,218,0.2)]"},FINANCEIRO:{chip:"bg-[#F58634] text-white",glow:"shadow-[0_0_0_3px_rgba(245,134,52,0.2)]"},USUARIO:{chip:"bg-[#3E4095] text-white",glow:"shadow-[0_0_0_3px_rgba(62,64,149,0.2)]"},ESTOQUE:{chip:"bg-[#0098DA] text-white",glow:"shadow-[0_0_0_3px_rgba(0,152,218,0.2)]"},CLIENTE:{chip:"bg-[#ED3237] text-white",glow:"shadow-[0_0_0_3px_rgba(237,50,55,0.2)]"}};function T({user:e,children:t,nav:r=_}){let n=(0,l.usePathname)(),{theme:o,setTheme:i}=(0,k.D)(),[d,c]=(0,a.useState)(!1),{confirm:h,Dialog:p}=(0,C.S)(),[x,m]=(0,a.useState)(!1),u=(0,a.useMemo)(()=>S[e?.role||"USUARIO"],[e?.role]),g=async()=>{if(!x&&await h({title:"Sair",message:"Deseja encerrar a sess\xe3o?",confirmText:"Sair",tone:"danger"})){m(!0);try{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch{}localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("userId")}finally{window.location.href="/login",m(!1)}}};return(0,s.jsxs)("div",{className:"min-h-screen w-full overflow-hidden bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800","data-testid":"shell-root",children:[(0,s.jsx)(P,{collapsed:d,roleTheme:u,user:e,theme:o,onToggleTheme:()=>{i("light"===o?"dark":"light")}}),(0,s.jsx)(U,{nav:r,activeHref:n||"/dashboard",collapsed:d,onToggle:()=>c(e=>!e),onLogout:g,isLoggingOut:x}),(0,s.jsx)("div",{className:`${d?"pl-[84px]":"pl-[280px]"} pt-16 transition-all`,children:(0,s.jsx)("main",{className:"mx-auto max-w-[1440px] p-4 sm:p-6","data-testid":"shell-content",children:t})}),(0,s.jsx)(p,{})]})}function P({collapsed:e,roleTheme:t,user:r,theme:a,onToggleTheme:o}){return(0,s.jsx)("header",{className:"fixed left-0 right-0 top-0 z-30 border-b border-white/30 bg-white/90 backdrop-blur-md dark:border-white/10 dark:bg-gray-900/90",children:(0,s.jsxs)("div",{className:`mx-auto flex h-16 max-w-[1440px] items-center justify-between gap-3 px-4 ${e?"pl-24":"pl-72"} transition-all`,children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-title text-base opacity-70",children:"GladPros"}),(0,s.jsx)("span",{className:`ml-1 rounded-full px-2 py-0.5 text-[10px] ${t.chip}`,children:r.role})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative hidden md:flex",children:[(0,s.jsx)(f.A,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-400"}),(0,s.jsx)("input",{placeholder:"Buscar…",className:"w-[260px] rounded-xl border border-gray-300 bg-white px-9 py-2 text-sm outline-none ring-0 placeholder:text-gray-400 focus:border-[#0098DA] focus:ring-2 focus:ring-[#0098DA]/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]}),(0,s.jsxs)("button",{className:"relative rounded-xl p-2 transition hover:bg-black/5 dark:hover:bg-white/10","aria-label":"Alertas",children:[(0,s.jsx)(w.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"absolute -right-1 -top-1 grid h-4 w-4 place-content-center rounded-full bg-[#ED3237] text-[10px] text-white",children:"3"})]}),(0,s.jsx)("button",{onClick:o,className:"rounded-xl p-2 transition hover:bg-black/5 dark:hover:bg-white/10","aria-label":"Alternar tema",children:"light"===a?(0,s.jsx)(v.A,{className:"h-5 w-5"}):(0,s.jsx)(j.A,{className:"h-5 w-5"})}),(0,s.jsx)("button",{className:"rounded-xl p-2 transition hover:bg-black/5 dark:hover:bg-white/10","aria-label":"Configura\xe7\xf5es",children:(0,s.jsx)(N.A,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{className:`ml-1 hidden items-center gap-2 rounded-2xl border border-gray-300 bg-white px-2 py-1 dark:border-gray-600 dark:bg-gray-700 md:flex ${t.glow}`,children:[(0,s.jsx)(n.default,{src:r.avatarUrl||"/images/LOGO_200.png",width:32,height:32,className:"h-8 w-8 rounded-full border border-gray-300 dark:border-gray-600 object-cover",alt:"avatar",onError:e=>{let t=e.target;t.src.endsWith("/images/LOGO_200.png")||(t.src="/images/LOGO_200.png")}}),(0,s.jsxs)("div",{className:"mr-1 hidden sm:block",children:[(0,s.jsx)("div",{className:"text-xs",children:r.name}),(0,s.jsx)("div",{className:"text-[10px] opacity-60",children:"Sess\xe3o ativa"})]})]})]})]})})}function U({nav:e,activeHref:t,collapsed:r,onToggle:a,onLogout:o,isLoggingOut:i=!1}){return(0,s.jsx)("aside",{className:`fixed left-0 top-0 z-40 h-screen ${r?"w-[84px]":"w-[280px]"} transition-all`,"aria-label":"Sidebar","data-testid":"shell-sidebar",children:(0,s.jsxs)("div",{className:"relative flex h-full flex-col border-r border-blue-200/50 bg-gradient-to-b from-[#3E4095] to-[#0098DA] text-white dark:border-blue-800/50",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2 px-4 py-4",children:[(0,s.jsx)("div",{className:"flex items-center gap-3",children:r?(0,s.jsx)("div",{className:"grid h-10 w-10 place-content-center rounded-xl bg-white/10 font-title shadow-md overflow-hidden",children:(0,s.jsx)(n.default,{src:"/images/LOGO_ICONE2.png",alt:"GP",width:36,height:36})}):(0,s.jsx)("div",{className:"relative h-9 w-[140px] leading-tight",children:(0,s.jsx)(n.default,{src:"/images/LOGO_200.png",alt:"GladPros",fill:!0,className:"object-contain",sizes:"140px",priority:!0})})}),(0,s.jsx)("button",{onClick:a,className:"rounded-xl p-2 hover:bg-white/10","aria-label":"Alternar sidebar",children:r?(0,s.jsx)(y.A,{className:"h-5 w-5"}):(0,s.jsx)(E.A,{className:"h-5 w-5"})})]}),(0,s.jsx)("nav",{className:"mt-2 flex-1 px-2",children:e.map((e,a)=>(0,s.jsx)(D,{href:e.href,icon:e.icon,label:e.label,active:t===e.href||t?.startsWith(e.href)&&"/"!==e.href,collapsed:r,delay:.03*a},e.href))}),(0,s.jsxs)("div",{className:"px-3 pb-4 pt-2",children:[(0,s.jsx)("button",{onClick:o,disabled:i,className:`flex w-full items-center justify-center gap-2 rounded-2xl px-3 py-2 text-sm text-white shadow ${i?"bg-[#ED3237]/80 opacity-80 cursor-not-allowed":"bg-[#ED3237] hover:brightness-110"}`,"data-testid":"sidebar-logout","aria-busy":i,children:i?(0,s.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white/40 border-t-white"}),!r&&(0,s.jsx)("span",{children:"Saindo…"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.A,{className:"h-4 w-4"}),!r&&(0,s.jsx)("span",{children:"Sair"})]})}),(0,s.jsx)("div",{className:"mt-3 text-center text-[10px] opacity-70",children:"v0.3 • Shell \xdanico"})]})]})})}function D({href:e,icon:t,label:r,active:a,collapsed:n,delay:o=0}){return(0,s.jsx)(i(),{href:e,className:"block focus:outline-none",children:(0,s.jsxs)(d.P.div,{initial:{opacity:0,x:-8},animate:{opacity:1,x:0},transition:{delay:o},title:n?r:void 0,className:`my-1 flex w-full items-center gap-3 rounded-xl px-3 py-2.5 text-sm transition hover:bg-white/10 ${a?"bg-white/15":"opacity-90"}`,children:[(0,s.jsx)(t,{className:`h-5 w-5 ${a?"text-white":"text-white/80"}`}),(0,s.jsx)(c.N,{initial:!1,children:!n&&(0,s.jsx)(d.P.span,{initial:{opacity:0,x:-6},animate:{opacity:1,x:0},exit:{opacity:0,x:-6},className:"truncate",children:r})}),a&&(0,s.jsx)("span",{className:"ml-auto h-2 w-2 rounded-full bg-white/90"})]})})}function I({title:e,badge:t,className:r="",children:a}){return(0,s.jsxs)("div",{className:`rounded-3xl border border-gray-200 bg-white p-4 sm:p-5 shadow-lg dark:border-gray-700 dark:bg-gray-800 ${r}`,"data-testid":"panel",children:[(0,s.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"font-title text-lg",children:e}),"number"==typeof t&&(0,s.jsx)("span",{className:"rounded-full bg-[#3E4095] px-2 py-0.5 text-xs text-white dark:bg-[#0098DA]",children:t})]}),a?(0,s.jsx)("div",{children:a}):(0,s.jsx)("div",{className:"grid h-44 place-content-center rounded-2xl border border-dashed border-gray-300 text-sm opacity-60 dark:border-gray-600",children:"\xc1rea para gr\xe1ficos/visualiza\xe7\xf5es"})]})}},48378:(e,t,r)=>{"use strict";r.d(t,{S:()=>l,z:()=>i});var s=r(87806),a=r(77412);let n=null;function o(){if(!n){let e="g5QZk5uXmGBy1267sLdrd8FHIzUqEtUrxnyJqoWYEqPklmXS1YiLp0ervYW7C017";if(e){if(e.length<32)throw Error("JWT_SECRET deve ter pelo menos 32 caracteres");n=new TextEncoder().encode(e)}else if("phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE||"phase-development-build"===process.env.NEXT_PHASE)console.warn("[JWT] Usando secret tempor\xe1rio durante build. Certifique-se de definir JWT_SECRET em produ\xe7\xe3o."),n=new TextEncoder().encode("temporary-build-secret-will-be-replaced-at-runtime-32-chars-minimum");else throw Error("Missing JWT_SECRET environment variable. Certifique-se de definir esta vari\xe1vel em .env.local")}return n}async function i(e,t="7d"){return await new s.P({role:e.role,status:e.status,tokenVersion:e.tokenVersion}).setProtectedHeader({alg:"HS256"}).setSubject(e.sub).setIssuer("gladpros").setAudience("gladpros-app").setExpirationTime(t).sign(o())}async function l(e){let{payload:t}=await (0,a.V)(e,o(),{issuer:"gladpros",audience:"gladpros-app"});return t}},55630:(e,t,r)=>{Promise.resolve().then(r.bind(r,80665))},80665:(e,t,r)=>{"use strict";r.d(t,{Panel:()=>n,default:()=>a});var s=r(12907);(0,s.registerClientReference)(function(){throw Error("Attempted to call DEFAULT_NAV() from the server but DEFAULT_NAV is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\components\\GladPros\\index.tsx","DEFAULT_NAV");let a=(0,s.registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\gladi\\\\Documents\\\\gladpros-nextjs\\\\src\\\\components\\\\GladPros\\\\index.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\components\\GladPros\\index.tsx","default");(0,s.registerClientReference)(function(){throw Error("Attempted to call HeaderBar() from the server but HeaderBar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\components\\GladPros\\index.tsx","HeaderBar"),(0,s.registerClientReference)(function(){throw Error("Attempted to call Sidebar() from the server but Sidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\components\\GladPros\\index.tsx","Sidebar");let n=(0,s.registerClientReference)(function(){throw Error("Attempted to call Panel() from the server but Panel is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\components\\GladPros\\index.tsx","Panel")}};