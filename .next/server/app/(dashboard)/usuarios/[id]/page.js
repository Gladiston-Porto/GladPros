(()=>{var e={};e.id=4080,e.ids=[4080],e.modules={1708:e=>{"use strict";e.exports=require("node:process")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{"use strict";e.exports=require("node:tty")},9476:(e,s,r)=>{"use strict";r.d(s,{default:()=>t});let t=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\gladi\\\\Documents\\\\gladpros-nextjs\\\\src\\\\modules\\\\usuarios\\\\pages\\\\DetailPage.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\modules\\usuarios\\pages\\DetailPage.tsx","default")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16698:e=>{"use strict";e.exports=require("node:async_hooks")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},36530:(e,s,r)=>{Promise.resolve().then(r.bind(r,58135))},48161:e=>{"use strict";e.exports=require("node:os")},51455:e=>{"use strict";e.exports=require("node:fs/promises")},57975:e=>{"use strict";e.exports=require("node:util")},58135:(e,s,r)=>{"use strict";r.d(s,{default:()=>x});var t=r(60687),a=r(43210),i=r(85814),d=r.n(i),o=r(69565);function n({userId:e}){let[s,r]=(0,a.useState)([]),[i,d]=(0,a.useState)([]),[o,n]=(0,a.useState)(!0),[l,c]=(0,a.useState)(!0),[u,x]=(0,a.useState)(null),m=(0,a.useCallback)(async()=>{try{n(!0);let s=await fetch(`/api/usuarios/${e}/sessions`);if(s.ok){let e=await s.json();r(e.sessions||[])}}catch{console.error("Erro ao carregar sess\xf5es")}finally{n(!1)}},[e]);(0,a.useCallback)(async()=>{try{c(!0);let s=await fetch(`/api/security/reports?type=login-attempts&userId=${e}`);if(s.ok){let e=await s.json();d(e.results||[])}}catch{console.error("Erro ao carregar tentativas")}finally{c(!1)}},[e]),(0,a.useCallback)(async()=>{try{let s=await fetch(`/api/usuarios/${e}/security`);if(s.ok){let e=await s.json();x({blocked:!!e.blocked,lastSuccessfulLoginAt:e.lastSuccessfulLoginAt||null})}}catch{console.error("Erro ao carregar status de seguran\xe7a:")}},[e]);let p=async e=>{try{(await fetch(`/api/usuarios/sessions/${e}`,{method:"DELETE"})).ok&&await m()}catch(e){console.error("Erro ao revogar sess\xe3o:",e)}},h=async()=>{if(confirm("Tem certeza que deseja encerrar todas as sess\xf5es ativas deste usu\xe1rio?"))try{(await fetch(`/api/usuarios/${e}/sessions`,{method:"DELETE"})).ok&&await m()}catch(e){console.error("Erro ao revogar todas as sess\xf5es:",e)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-black/10 bg-white p-4 dark:border-white/10 dark:bg-white/5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"font-semibold text-lg",children:"Sess\xf5es Ativas"}),s.length>0&&(0,t.jsx)("button",{onClick:h,className:"text-xs bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600",children:"\uD83D\uDEAB Revogar Todas"})]}),o?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-blue-600 border-t-transparent"}),(0,t.jsx)("span",{className:"ml-2",children:"Carregando sess\xf5es..."})]}):0===s.length?(0,t.jsx)("div",{className:"text-gray-500 py-4",children:"Nenhuma sess\xe3o ativa encontrada."}):(0,t.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,t.jsx)("div",{className:"border rounded-lg p-3 bg-gray-50",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,t.jsx)("span",{className:"font-medium",children:"Sess\xe3o Ativa"}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["Token: ",e.token?.substring(0,8),"..."]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"IP:"})," ",e.ip||"N\xe3o informado"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Criada em:"})," ",new Date(e.criadaEm).toLocaleString("pt-BR")]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("strong",{children:"User Agent:"}),(0,t.jsx)("div",{className:"text-xs text-gray-600 mt-1 break-all",children:e.userAgent||"N\xe3o informado"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"\xdaltima Atividade:"})," ",new Date(e.ultimaAtividade).toLocaleString("pt-BR")]})]})]}),(0,t.jsx)("button",{onClick:()=>p(e.id),className:"ml-4 text-xs bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"\uD83D\uDEAB Revogar"})]})},e.id))})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-black/10 bg-white p-4 dark:border-white/10 dark:bg-white/5",children:[(0,t.jsx)("h3",{className:"font-semibold text-lg mb-4",children:"Tentativas de Login"}),l?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-blue-600 border-t-transparent"}),(0,t.jsx)("span",{className:"ml-2",children:"Carregando tentativas..."})]}):0===i.length?(0,t.jsx)("div",{className:"text-gray-500 py-4",children:"Nenhuma tentativa de login registrada."}):(0,t.jsx)("div",{className:"space-y-2",children:i.map(e=>{let s=e.criadaEm?new Date(e.criadaEm):null,r=s&&!isNaN(s.getTime())?s.toLocaleString("pt-BR"):"-";return(0,t.jsx)("div",{className:`border-l-4 pl-4 py-2 ${e.sucesso?"border-green-500 bg-green-50":"border-red-500 bg-red-50"}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsx)("span",{className:`w-2 h-2 rounded-full ${e.sucesso?"bg-green-500":"bg-red-500"}`}),(0,t.jsx)("span",{className:`font-medium ${e.sucesso?"text-green-700":"text-red-700"}`,children:e.sucesso?"✅ Login bem-sucedido":"❌ Falha no login"}),e.email&&(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["Email: ",e.email]}),e.ip&&(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["IP: ",e.ip]}),!e.sucesso&&e.motivoFalha&&(0,t.jsxs)("span",{className:"text-xs rounded bg-red-100 text-red-700 px-2 py-0.5",children:["Motivo: ","INVALID_EMAIL"===e.motivoFalha?"Email inexistente":"INVALID_PASSWORD"===e.motivoFalha?"Senha incorreta":e.motivoFalha]})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:r})]})},e.id)})})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-black/10 bg-white p-4 dark:border-white/10 dark:bg-white/5",children:[(0,t.jsx)("h3",{className:"font-semibold text-lg mb-4",children:"Informa\xe7\xf5es de Seguran\xe7a"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Tentativas de Login Falharam"}),(0,t.jsx)("div",{className:"text-lg font-bold text-red-600",children:i.filter(e=>!e.sucesso).length})]}),(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Sess\xf5es Ativas"}),(0,t.jsx)("div",{className:"text-lg font-bold text-green-600",children:s.length})]}),(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"\xdaltimo Login Bem-sucedido"}),(0,t.jsx)("div",{className:"text-sm font-medium",children:(()=>{let e=u?.lastSuccessfulLoginAt;if(!e)return"Nenhum login registrado";let s=new Date(e);return isNaN(s.getTime())?"-":s.toLocaleString("pt-BR")})()})]}),(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Status da Conta"}),(0,t.jsx)("div",{className:`text-sm font-medium ${u?.blocked?"text-red-600":"text-green-600"}`,children:u?.blocked?"\uD83D\uDD12 Bloqueada":"\uD83D\uDD13 Ativa"})]})]})]})]})}var l=r(77261),c=r(16189),u=r(6963);function x({id:e}){let s=(0,c.useRouter)(),{showToast:r}=(0,u.d)(),[i,x]=(0,a.useState)(null),[m,p]=(0,a.useState)("dados"),[h,g]=(0,a.useState)(!1),[b,j]=(0,a.useState)(!0),[v,N]=(0,a.useState)([]),[f,y]=(0,a.useState)(!1),[E,w]=(0,a.useState)(null);async function D(t){g(!0),w(null);try{await (0,l.TK)(e,t),r({title:"Sucesso",message:"Usu\xe1rio atualizado",type:"success"}),s.push("/usuarios")}catch(s){if(s?.fields)throw s;let e=s?.message??"Erro ao atualizar usu\xe1rio";w(e),r({title:"Erro",message:e,type:"error"})}finally{g(!1)}}return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"font-title text-xl",children:"Editar Usu\xe1rio"}),(0,t.jsx)(d(),{href:"/usuarios",className:"rounded-xl border px-3 py-2 text-sm",children:"Voltar"})]}),b&&(0,t.jsx)("div",{className:"rounded-xl border border-black/10 bg-white p-4 text-sm opacity-70 dark:border-white/10 dark:bg-white/5",children:"Carregando…"}),!b&&E&&(0,t.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:E}),i&&(0,t.jsx)("div",{className:"flex gap-2",children:["dados","permissoes","auditoria","seguranca"].map(e=>(0,t.jsx)("button",{onClick:()=>p(e),className:`rounded-xl px-3 py-2 text-sm ${m===e?"bg-[#0098DA] text-white":"border border-black/10 bg-white dark:border-white/10 dark:bg-white/5"}`,children:"dados"===e?"Dados":"permissoes"===e?"Permiss\xf5es":"auditoria"===e?"Auditoria":"Seguran\xe7a"},e))}),i&&"dados"===m&&(0,t.jsx)(o.A,{initial:{...i,dataNascimento:"string"==typeof i.dataNascimento?i.dataNascimento:i.dataNascimento?new Date(i.dataNascimento).toISOString().slice(0,10):void 0},onSubmit:D,submitting:h}),"permissoes"===m&&i&&(0,t.jsxs)("div",{className:"rounded-2xl border border-black/10 bg-white p-4 space-y-4 dark:border-white/10 dark:bg-white/5",children:[(0,t.jsx)("h3",{className:"font-semibold text-lg",children:"Permiss\xf5es do Usu\xe1rio"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"N\xedvel/Role:"})," ",i.role||"USUARIO"]}),(0,t.jsx)("div",{className:`px-2 py-1 rounded text-xs font-medium ${"ADMIN"===i.role?"bg-red-100 text-red-800":"GERENTE"===i.role?"bg-blue-100 text-blue-800":"FINANCEIRO"===i.role?"bg-green-100 text-green-800":"ESTOQUE"===i.role?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:"ADMIN"===i.role?"Acesso Total":"GERENTE"===i.role?"Gerenciamento":"FINANCEIRO"===i.role?"Financeiro":"ESTOQUE"===i.role?"Estoque":"Usu\xe1rio Padr\xe3o"})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:Object.entries({Usuários:"usuarios",Financeiro:"financeiro",Clientes:"clientes",Projetos:"projetos",Propostas:"propostas",Estoque:"estoque"}).map(([e,s])=>{let r=i.role||"USUARIO";return(0,t.jsxs)("div",{className:"p-3 border rounded-lg",children:[(0,t.jsx)("div",{className:"font-medium mb-2",children:e}),(0,t.jsx)("div",{className:"space-y-1 text-xs",children:["read","create","update","delete"].map(e=>{let a=!1;return a="ADMIN"===r||("GERENTE"===r?"usuarios"!==s||"read"===e:"FINANCEIRO"===r?"financeiro"===s||"clientes"===s&&"read"===e||"propostas"===s||"projetos"===s&&"read"===e:"ESTOQUE"===r?"estoque"===s||"projetos"===s&&"read"===e||"clientes"===s&&"read"===e:"clientes"===s||"projetos"===s),(0,t.jsxs)("div",{className:`flex justify-between ${a?"text-green-600":"text-red-500"}`,children:[(0,t.jsx)("span",{children:"read"===e?"Ler":"create"===e?"Criar":"update"===e?"Editar":"Excluir"}),(0,t.jsx)("span",{children:a?"✓":"✗"})]},e)})})]},s)})})]})]}),"auditoria"===m&&(0,t.jsxs)("div",{className:"rounded-2xl border border-black/10 bg-white p-4 text-sm dark:border-white/10 dark:bg-white/5",children:[(0,t.jsx)("div",{className:"mb-4 font-semibold",children:"Hist\xf3rico de Auditoria"}),f?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-blue-600 border-t-transparent"}),(0,t.jsx)("span",{className:"ml-2",children:"Carregando..."})]}):0===v.length?(0,t.jsx)("div",{className:"text-gray-500 py-4",children:"Nenhum log de auditoria encontrado."}):(0,t.jsx)("div",{className:"space-y-2",children:v.map(e=>{let s={CREATE:"Criado",UPDATE:"Atualizado",DELETE:"Exclu\xeddo",LOGIN:"Login realizado",LOGOUT:"Logout realizado"}[e.acao]||e.acao,r={CREATE:"text-green-600",UPDATE:"text-blue-600",DELETE:"text-red-600",LOGIN:"text-purple-600",LOGOUT:"text-gray-600"}[e.acao]||"text-gray-600",a={CREATE:"✅",UPDATE:"\uD83D\uDCDD",DELETE:"\uD83D\uDDD1️",LOGIN:"\uD83D\uDD10",LOGOUT:"\uD83D\uDCE4"}[e.acao]||"\uD83D\uDCCB";return(0,t.jsxs)("div",{className:"border-l-4 border-gray-300 pl-4 py-3 bg-gray-50 rounded-r-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-lg",children:a}),(0,t.jsx)("span",{className:`font-medium ${r}`,children:s}),(0,t.jsx)("span",{className:"text-gray-400",children:"•"}),(0,t.jsx)("span",{className:"text-gray-700",children:(()=>{if("CREATE"===e.acao)return"Usu\xe1rio criado no sistema";if("UPDATE"===e.acao)return"Dados do usu\xe1rio atualizados";if("LOGIN"===e.acao)return"Realizou login no sistema";if("LOGOUT"===e.acao)return"Saiu do sistema";if("DELETE"===e.acao)return"Usu\xe1rio exclu\xeddo do sistema";return`${s} - ${e.tabela}`})()})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.criadoEm).toLocaleString("pt-BR")})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-2 flex items-center gap-4",children:[e.nomeCompleto||e.email?(0,t.jsxs)("span",{children:["\uD83D\uDC64 ",(0,t.jsx)("span",{className:"font-medium text-gray-700",children:e.nomeCompleto||e.email})]}):e.usuarioId?(0,t.jsxs)("span",{children:["\uD83D\uDC64 Usu\xe1rio #",e.usuarioId]}):(0,t.jsx)("span",{children:"\uD83E\uDD16 Sistema"}),e.ip&&(0,t.jsxs)("span",{children:["\uD83C\uDF10 IP: ",e.ip]})]}),e.payload&&(0,t.jsxs)("details",{className:"mt-3",children:[(0,t.jsx)("summary",{className:"text-xs text-blue-600 cursor-pointer hover:text-blue-800 font-medium",children:"\uD83D\uDCCB Ver detalhes t\xe9cnicos"}),(0,t.jsx)("pre",{className:"text-xs bg-gray-100 dark:bg-gray-800 p-3 rounded mt-2 overflow-x-auto border",children:JSON.stringify(JSON.parse(e.payload),null,2)})]})]},e.id)})})]}),"seguranca"===m&&i&&(0,t.jsx)(n,{userId:i.id})]})}},59474:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t.default});var t=r(9476)},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78474:e=>{"use strict";e.exports=require("node:events")},79551:e=>{"use strict";e.exports=require("url")},96778:(e,s,r)=>{Promise.resolve().then(r.bind(r,9476))},99520:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>d.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>l});var t=r(65239),a=r(48088),i=r(88170),d=r.n(i),o=r(30893),n={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);r.d(s,n);let l={children:["",{children:["(dashboard)",{children:["usuarios",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,59474)),"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\(dashboard)\\usuarios\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,57675)),"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\(dashboard)\\layout.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,51520))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,54431)),"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\error.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,54413)),"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,51520))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\(dashboard)\\usuarios\\[id]\\page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/(dashboard)/usuarios/[id]/page",pathname:"/usuarios/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[7719,9942,4250,4553,5814,6994,6792,7920,8964,6433],()=>r(99520));module.exports=t})();