(()=>{var e={};e.id=6478,e.ids=[6478],e.modules={1708:e=>{"use strict";e.exports=require("node:process")},1737:(e,t,r)=>{"use strict";r.d(t,{HU:()=>s,fg:()=>i});var o=r(77598),a=r.n(o);function s(e=32){return a().randomBytes(e).toString("hex")}function i(e){return a().createHash("sha256").update(e).digest("hex")}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{"use strict";e.exports=require("node:tty")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13641:(e,t,r)=>{"use strict";r.d(t,{z:()=>o.z});var o=r(31183)},16698:e=>{"use strict";e.exports=require("node:async_hooks")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var o=r(29942);let a=global.__prisma??new o.PrismaClient({log:["error"]})},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{"use strict";e.exports=require("node:os")},51455:e=>{"use strict";e.exports=require("node:fs/promises")},55511:e=>{"use strict";e.exports=require("crypto")},57975:e=>{"use strict";e.exports=require("node:util")},59375:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>c,serverHooks:()=>x,workAsyncStorage:()=>I,workUnitAsyncStorage:()=>g});var o={};r.r(o),r.d(o,{POST:()=>m});var a=r(96559),s=r(48088),i=r(37719),n=r(32190),u=r(18318),p=r(13641),d=r(1737),l=r(69812);async function m(e){if("phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE)return n.NextResponse.json({error:"Service temporarily unavailable"},{status:503});let t=await e.json().catch(()=>({})),r=l.KS.safeParse(t);if(!r.success)return n.NextResponse.json({error:"Token inv\xe1lido ou senha fraca"},{status:400});let{token:o,senha:a}=r.data,s=(0,d.fg)(String(o)),i=(await p.z.$queryRaw`
    SELECT id, userId, expiresAt, used
    FROM PasswordResetToken
    WHERE tokenHash = ${s}
    ORDER BY createdAt DESC
    LIMIT 1
  `)[0];if(!i)return n.NextResponse.json({error:"Token inv\xe1lido"},{status:400});if(i.used)return n.NextResponse.json({error:"Token j\xe1 utilizado"},{status:400});if(new Date>i.expiresAt)return n.NextResponse.json({error:"Token expirado"},{status:400});let m=await u.default.hash(String(a),12);return await p.z.$executeRaw`
    UPDATE Usuario 
    SET senha = ${m}, atualizadoEm = NOW()
    WHERE id = ${i.userId}
  `,await p.z.$executeRaw`
    UPDATE PasswordResetToken SET used = TRUE WHERE id = ${i.id}
  `,n.NextResponse.json({ok:!0})}let c=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/auth/reset-password/route",pathname:"/api/auth/reset-password",filename:"route",bundlePath:"app/api/auth/reset-password/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\auth\\reset-password\\route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:I,workUnitAsyncStorage:g,serverHooks:x}=c;function v(){return(0,i.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:g})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},69812:(e,t,r)=>{"use strict";r.d(t,{B0:()=>c,Dm:()=>v,E9:()=>x,KS:()=>g,PQ:()=>j,X5:()=>l,Zk:()=>f,cQ:()=>k,if:()=>h,rf:()=>m,tT:()=>I,yp:()=>E});var o=r(24501);let a=o.Yj().email("Email inv\xe1lido").max(255,"Email muito longo").toLowerCase().trim(),s=o.Yj().min(6,"Senha deve ter pelo menos 6 caracteres").max(128,"Senha muito longa").refine(e=>!!/[a-z]/.test(e)&&!!/[A-Z0-9]/.test(e),"Senha deve conter pelo menos: 1 letra min\xfascula e 1 mai\xfascula ou n\xfamero"),i=o.Yj().min(2,"Nome deve ter pelo menos 2 caracteres").max(100,"Nome muito longo").trim().refine(e=>/^[a-zA-ZÀ-ÿ\s]+$/.test(e),"Nome deve conter apenas letras e espa\xe7os"),n=o.Yj().length(4,"PIN deve ter exatamente 4 d\xedgitos").refine(e=>/^\d{4}$/.test(e),"PIN deve conter apenas n\xfameros"),u=o.Yj().length(6,"C\xf3digo MFA deve ter exatamente 6 d\xedgitos").refine(e=>/^\d{6}$/.test(e),"C\xf3digo MFA deve conter apenas n\xfameros"),p=o.Yj().min(5,"Pergunta de seguran\xe7a muito curta").max(200,"Pergunta de seguran\xe7a muito longa").trim(),d=o.Yj().min(2,"Resposta muito curta").max(100,"Resposta muito longa").trim().toLowerCase(),l=o.Ik({email:a,password:o.Yj().min(1,"Senha \xe9 obrigat\xf3ria")}),m=o.Ik({userId:o.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),code:u,tipoAcao:o.k5(["LOGIN","PRIMEIRO_ACESSO","RESET_PASSWORD"]).optional()}),c=o.Ik({email:a});o.Ik({userId:o.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),novaSenha:s,pin:n,perguntaSeguranca:p,respostaSeguranca:d});let I=o.Ik({userId:o.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),newPassword:s,pin:n,securityQuestion:p,securityAnswer:d});o.Ik({token:o.Yj().min(1,"Token \xe9 obrigat\xf3rio"),novaSenha:s});let g=o.Ik({token:o.Yj().min(1,"Token \xe9 obrigat\xf3rio"),senha:s}),x=o.Ik({email:a}),v=o.Ik({email:a});o.Ik({nomeCompleto:i,email:a,tipo:o.k5(["ADMIN","USUARIO","CLIENTE"]),departamento:o.Yj().max(100,"Departamento muito longo").optional(),cargo:o.Yj().max(100,"Cargo muito longo").optional()}),o.Ik({nomeCompleto:i.optional(),email:a.optional(),tipo:o.k5(["ADMIN","USUARIO","CLIENTE"]).optional(),departamento:o.Yj().max(100,"Departamento muito longo").optional(),cargo:o.Yj().max(100,"Cargo muito longo").optional(),status:o.k5(["ATIVO","INATIVO","SUSPENSO"]).optional()}).refine(e=>Object.keys(e).length>0,"Pelo menos um campo deve ser fornecido para atualiza\xe7\xe3o");let E=o.gM("method",[o.Ik({method:o.eu("pin"),userId:o.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),pin:n}),o.Ik({method:o.eu("security"),userId:o.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),answer:d})]),f=o.Ik({userId:o.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),tipoAcao:o.k5(["LOGIN","PRIMEIRO_ACESSO","RESET_PASSWORD","RESET","DESBLOQUEIO"]).optional()}),S=o.Ik({nomeCompleto:o.Yj().optional(),email:a,role:o.Yj().optional(),ativo:o.zM().optional(),criadoEm:o.KC([o.Yj(),o.ai(),o.p6()]).optional()}),h=o.Ik({filename:o.Yj().min(1).max(128).optional(),users:o.YO(S).min(1)}),k=o.Ik({email:a.optional(),nomeCompleto:i.optional(),role:o.k5(["ADMIN","GERENTE","USUARIO","FINANCEIRO","ESTOQUE","CLIENTE"]).optional(),status:o.k5(["ATIVO","INATIVO"]).optional(),telefone:o.Yj().max(32).optional().or(o.eu("")).transform(e=>e||void 0).refine(e=>{if(!e)return!0;let t=e.replace(/\D/g,"");return t.length>=10&&t.length<=11},"Telefone deve ter entre 10 e 11 d\xedgitos. Exemplo: (11)99999-9999"),dataNascimento:o.KC([o.Yj(),o.p6()]).optional().transform(e=>{if(!e)return;if(e instanceof Date){if(isNaN(e.getTime()))return;let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${o}`}let t=String(e).trim();if(t.match(/^(\d{4})-(\d{2})-(\d{2})$/))return t;let r=t.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(r){let[,e,t,o]=r,a=parseInt(t,10),s=parseInt(e,10);if(s<1||s>12||a<1||a>31)return"INVALID_DATE";let i=t.padStart(2,"0"),n=e.padStart(2,"0");return`${o}-${n}-${i}`}return"INVALID_DATE"}).refine(e=>!e||"INVALID_DATE"!==e&&!isNaN(new Date(e+"T00:00:00.000Z").getTime()),"Data de nascimento inv\xe1lida. Use o formato MM/DD/YYYY (ex: 05/18/1979)"),endereco1:o.Yj().max(191).optional().or(o.eu("")).transform(e=>e||void 0),endereco2:o.Yj().max(191).optional().or(o.eu("")).transform(e=>e||void 0),cidade:o.Yj().max(96).optional().or(o.eu("")).transform(e=>e||void 0),estado:o.Yj().max(32).optional().or(o.eu("")).transform(e=>e||void 0),cep:o.Yj().max(16).optional().or(o.eu("")).transform(e=>e||void 0).refine(e=>{if(!e)return!0;let t=e.replace(/\D/g,"");return t.length>=5&&t.length<=9&&t===e.replace(/\D/g,"")},"CEP deve conter apenas n\xfameros. Exemplo: 01234567"),anotacoes:o.Yj().optional().or(o.eu("")).transform(e=>e&&e.trim().length>0?e:void 0)}),j=o.Ik({ativo:o.zM()})},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},78474:e=>{"use strict";e.exports=require("node:events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[7719,580,9942,4501,8318],()=>r(59375));module.exports=o})();