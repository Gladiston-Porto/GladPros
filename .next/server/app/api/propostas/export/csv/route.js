(()=>{var e={};e.id=7327,e.ids=[7327],e.modules={1708:e=>{"use strict";e.exports=require("node:process")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{"use strict";e.exports=require("node:tty")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13641:(e,t,r)=>{"use strict";r.d(t,{z:()=>s.z});var s=r(31183)},16698:e=>{"use strict";e.exports=require("node:async_hooks")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,t,r)=>{"use strict";r.d(t,{z:()=>o});var s=r(29942);let o=global.__prisma??new s.PrismaClient({log:["error"]})},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{"use strict";e.exports=require("node:os")},51455:e=>{"use strict";e.exports=require("node:fs/promises")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72659:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>c,serverHooks:()=>x,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{POST:()=>u});var o=r(96559),a=r(48088),i=r(37719),n=r(32190),p=r(13641);async function u(e){if("phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE)return n.NextResponse.json({error:"Service temporarily unavailable"},{status:503});try{let{filename:t="propostas",filters:r={}}=await e.json(),s={};r.q&&(s.OR=[{titulo:{contains:r.q}},{numeroProposta:{contains:r.q}},{cliente:{nome:{contains:r.q}}}]),r.status&&"all"!==r.status&&(s.status=r.status),r.clienteId&&(s.clienteId=r.clienteId);let o=p.z,a=(await o.proposta.findMany({where:s,include:{cliente:{select:{nome:!0,email:!0}}},orderBy:{criadoEm:"desc"}})).map(e=>[e.numeroProposta,e.titulo,e.cliente.nome,e.status,e.precoPropostaCliente?.toFixed(2)||"",(e.valorEstimado??0).toFixed(2),e.criadoEm.toLocaleDateString("pt-BR"),e.validadeProposta?e.validadeProposta.toLocaleDateString("pt-BR"):"",e.assinadoEm?e.assinadoEm.toLocaleDateString("pt-BR"):"",e.contatoNome||"",e.contatoEmail||"",e.localExecucaoEndereco||""]),i=[["N\xfamero","T\xedtulo","Cliente","Status","Valor Cliente (USD)","Valor Estimado (USD)","Criado Em","Validade","Assinado Em","Contato","Email Contato","Endere\xe7o Execu\xe7\xe3o"],...a].map(e=>e.map(e=>`"${String(e??"")}"`).join(",")).join("\n");return new n.NextResponse(i,{headers:{"Content-Type":"text/csv; charset=utf-8","Content-Disposition":`attachment; filename="${t}.csv"`}})}catch(e){return console.error("[CSV Export] Erro:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/propostas/export/csv/route",pathname:"/api/propostas/export/csv",filename:"route",bundlePath:"app/api/propostas/export/csv/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\propostas\\export\\csv\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:x}=c;function m(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},78474:e=>{"use strict";e.exports=require("node:events")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,580,9942],()=>r(72659));module.exports=s})();