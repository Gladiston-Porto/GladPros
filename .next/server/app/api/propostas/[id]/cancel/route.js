(()=>{var e={};e.id=2314,e.ids=[2314],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},26476:(e,t,r)=>{"use strict";r.d(t,{f6:()=>a,pQ:()=>o});var a=function(e){return e.RASCUNHO="RASCUNHO",e.ENVIADA="ENVIADA",e.ASSINADA="ASSINADA",e.APROVADA="APROVADA",e.CANCELADA="CANCELADA",e}({}),o=function(e){return e.CREATED="CREATED",e.UPDATED="UPDATED",e.SENT="SENT",e.SIGNED="SIGNED",e.APPROVED="APPROVED",e.CANCELLED="CANCELLED",e.ATTACH_ADDED="ATTACH_ADDED",e.ATTACH_REMOVED="ATTACH_REMOVED",e}({})},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33911:(e,t,r)=>{"use strict";r.d(t,{db:()=>n});class a{constructor(e){this.proposta={},this.propostaLog={},this.propostaEtapa={},this.propostaMaterial={},this.cliente={},this.usuario={}}$connect(){return Promise.resolve()}$disconnect(){return Promise.resolve()}$transaction(e){return e({})}generatePropostaNumber(){let e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),o=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return Promise.resolve(`PROP-${t}${r}${a}-${o}`)}}let o=globalThis;class s extends a{async generatePropostaNumber(){let e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),o=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return`PROP-${t}${r}${a}-${o}`}}let n=o.prisma??new s},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},78784:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>E,routeModule:()=>c,serverHooks:()=>D,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>A});var a={};r.r(a),r.d(a,{POST:()=>d});var o=r(96559),s=r(48088),n=r(37719),i=r(32190),p=r(33911),u=r(26476);async function d(e,{params:t}){try{let{id:r}=t,{motivo:a}=await e.json();if(!await p.db.proposta.findFirst({where:{id:r,deletedAt:null,status:{in:[u.f6.RASCUNHO,u.f6.ENVIADA]}}}))return i.NextResponse.json({error:"Proposta n\xe3o encontrada ou n\xe3o pode ser cancelada"},{status:404});let o=await p.db.$transaction(async t=>{let o=await t.proposta.update({where:{id:r},data:{status:u.f6.CANCELADA,assinadaEm:null,motivo_cancelamento:a||"Cancelado pelo usu\xe1rio",atualizadoEm:new Date}});return await t.propostaLog.create({data:{propostaId:r,usuarioId:"temp-user-id",acao:u.pQ.CANCELLED,detalhes:`Proposta ${o.numeroProposta} cancelada. Motivo: ${a||"N\xe3o informado"}`,ip:e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}),o});return i.NextResponse.json({message:"Proposta cancelada com sucesso",proposta:o})}catch(e){return console.error("Error cancelling proposta:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/propostas/[id]/cancel/route",pathname:"/api/propostas/[id]/cancel",filename:"route",bundlePath:"app/api/propostas/[id]/cancel/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\propostas\\[id]\\cancel\\route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:l,workUnitAsyncStorage:A,serverHooks:D}=c;function E(){return(0,n.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:A})}},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[7719,580],()=>r(78784));module.exports=a})();