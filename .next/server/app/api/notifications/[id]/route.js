(()=>{var e={};e.id=2240,e.ids=[2240],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},14985:e=>{"use strict";e.exports=require("dns")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},28617:(e,t,r)=>{"use strict";r.d(t,{J:()=>n});var s=r(70300),a=r.n(s);class i{constructor(){this.redis=null,this.memoryCache=new Map,this.initializeRedis(),setInterval(()=>{this.cleanupMemoryCache()},3e5)}async initializeRedis(){try{this.redis=new(a())({host:process.env.REDIS_HOST||"localhost",port:parseInt(process.env.REDIS_PORT||"6379"),password:process.env.REDIS_PASSWORD,lazyConnect:!0,connectTimeout:2e3,maxRetriesPerRequest:2}),await this.redis.ping(),console.log("[CACHE] Redis conectado com sucesso")}catch(e){console.warn("[CACHE] Redis n\xe3o dispon\xedvel, usando cache em mem\xf3ria:",e),this.redis=null}}cleanupMemoryCache(){let e=Date.now();for(let[t,r]of this.memoryCache.entries())r.expires<e&&this.memoryCache.delete(t)}async get(e){try{if(this.redis){let t=await this.redis.get(e);return t?JSON.parse(t):null}{let t=this.memoryCache.get(e);if(t&&t.expires>Date.now())return t.value;return this.memoryCache.delete(e),null}}catch(e){return console.error("[CACHE] Erro ao buscar:",e),null}}async set(e,t,r=3600){try{if(this.redis)return await this.redis.setex(e,r,JSON.stringify(t)),!0;return this.memoryCache.set(e,{value:t,expires:Date.now()+1e3*r}),!0}catch(e){return console.error("[CACHE] Erro ao salvar:",e),!1}}async delete(e){try{if(this.redis)return await this.redis.del(e),!0;return this.memoryCache.delete(e),!0}catch(e){return console.error("[CACHE] Erro ao deletar:",e),!1}}async deletePattern(e){try{if(this.redis){let t=await this.redis.keys(e);return t.length>0&&await this.redis.del(...t),t.length}{let t=0,r=new RegExp(e.replace(/\*/g,".*"));for(let e of this.memoryCache.keys())r.test(e)&&(this.memoryCache.delete(e),t++);return t}}catch(e){return console.error("[CACHE] Erro ao deletar padr\xe3o:",e),0}}async exists(e){try{if(this.redis){let t=await this.redis.exists(e);return 1===t}{let t=this.memoryCache.get(e);return!!(t&&t.expires>Date.now())}}catch(e){return console.error("[CACHE] Erro ao verificar exist\xeancia:",e),!1}}async setUserSession(e,t,r=86400){return this.set(`user_session:${e}`,t,r)}async getUserSession(e){return this.get(`user_session:${e}`)}async deleteUserSession(e){return this.delete(`user_session:${e}`)}async setUserData(e,t,r=1800){return this.set(`user_data:${e}`,t,r)}async getUserData(e){return this.get(`user_data:${e}`)}async invalidateUserData(e){return this.delete(`user_data:${e}`)}async setListData(e,t,r,s,a=600){let i=`list:${e}:${t}:${r}`;return this.set(i,s,a)}async getListData(e,t,r){let s=`list:${e}:${t}:${r}`;return this.get(s)}async invalidateListData(e){return this.deletePattern(`list:${e}:*`)}async setDashboardStats(e,t,r=300){return this.set(`dashboard_stats:${e}`,t,r)}async getDashboardStats(e){return this.get(`dashboard_stats:${e}`)}async setSystemConfig(e,t,r=3600){return this.set(`system_config:${e}`,t,r)}async getSystemConfig(e){return this.get(`system_config:${e}`)}async getStats(){let e={redis:!!this.redis,memoryKeys:this.memoryCache.size};if(this.redis)try{let t=(await this.redis.info("keyspace")).match(/db0:keys=(\d+)/);return{...e,redisKeys:t?parseInt(t[1]):0}}catch(e){console.error("[CACHE] Erro ao obter estat\xedsticas do Redis:",e)}return e}async flush(){try{return this.redis&&await this.redis.flushdb(),this.memoryCache.clear(),console.log("[CACHE] Cache limpo completamente"),!0}catch(e){return console.error("[CACHE] Erro ao limpar cache:",e),!1}}async healthCheck(){let e={redis:!1,memory:!0,error:void 0};try{this.redis&&(await this.redis.ping(),e.redis=!0)}catch(t){e.error=`Redis: ${t}`}return e}}let o=new i;class n{static{this.CACHE_PREFIX="notifications"}static{this.USER_NOTIFICATIONS_KEY=e=>`${this.CACHE_PREFIX}:user:${e}`}static{this.GLOBAL_NOTIFICATIONS_KEY=`${this.CACHE_PREFIX}:global`}static async create(e){let t=`notif_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r={...e,id:t,read:!1,createdAt:new Date};try{let s=this.USER_NOTIFICATIONS_KEY(e.userId),a=await o.get(s)||[],i=[r,...a].slice(0,100);return await o.set(s,i,2592e3),console.log(`[NOTIFICATIONS] Nova notifica\xe7\xe3o criada para usu\xe1rio ${e.userId}: ${e.title}`),t}catch(e){throw console.error("[NOTIFICATIONS] Erro ao criar notifica\xe7\xe3o:",e),Error("Falha ao criar notifica\xe7\xe3o")}}static async getUserNotifications(e,t){try{let r=this.USER_NOTIFICATIONS_KEY(e),s=(await o.get(r)||[]).filter(e=>!e.expiresAt||new Date(e.expiresAt)>new Date),a=s;t?.unreadOnly&&(a=s.filter(e=>!e.read));let i=t?.offset||0,n=t?.limit||20,c=a.slice(i,i+n),l=s.filter(e=>!e.read).length;return{notifications:c,total:a.length,unreadCount:l}}catch(e){return console.error("[NOTIFICATIONS] Erro ao buscar notifica\xe7\xf5es:",e),{notifications:[],total:0,unreadCount:0}}}static async markAsRead(e,t){try{let r=this.USER_NOTIFICATIONS_KEY(e),s=(await o.get(r)||[]).map(e=>e.id===t?{...e,read:!0}:e);return await o.set(r,s,2592e3),console.log(`[NOTIFICATIONS] Notifica\xe7\xe3o ${t} marcada como lida`),!0}catch(e){return console.error("[NOTIFICATIONS] Erro ao marcar como lida:",e),!1}}static async markAllAsRead(e){try{let t=this.USER_NOTIFICATIONS_KEY(e),r=(await o.get(t)||[]).map(e=>({...e,read:!0}));return await o.set(t,r,2592e3),console.log(`[NOTIFICATIONS] Todas notifica\xe7\xf5es marcadas como lidas para usu\xe1rio ${e}`),!0}catch(e){return console.error("[NOTIFICATIONS] Erro ao marcar todas como lidas:",e),!1}}static async delete(e,t){try{let r=this.USER_NOTIFICATIONS_KEY(e),s=(await o.get(r)||[]).filter(e=>e.id!==t);return await o.set(r,s,2592e3),console.log(`[NOTIFICATIONS] Notifica\xe7\xe3o ${t} deletada`),!0}catch(e){return console.error("[NOTIFICATIONS] Erro ao deletar notifica\xe7\xe3o:",e),!1}}static async cleanup(e){try{let t=this.USER_NOTIFICATIONS_KEY(e),r=await o.get(t)||[],s=new Date,a=r.filter(e=>{if(e.expiresAt&&new Date(e.expiresAt)<=s)return!1;if(e.read){let t=new Date(s.getTime()-6048e5);return new Date(e.createdAt)>t}return!0}),i=r.length-a.length;return i>0&&(await o.set(t,a,2592e3),console.log(`[NOTIFICATIONS] ${i} notifica\xe7\xf5es antigas removidas para usu\xe1rio ${e}`)),i}catch(e){return console.error("[NOTIFICATIONS] Erro na limpeza:",e),0}}static async notifyLogin(e,t,r){return this.create({userId:e,type:"info",title:"Novo login detectado",message:`Login realizado com sucesso de ${t}`,data:{ip:t,userAgent:r,type:"login"}})}static async notifyPasswordChanged(e){return this.create({userId:e,type:"success",title:"Senha alterada",message:"Sua senha foi alterada com sucesso",data:{type:"password_change"}})}static async notifySecurityAlert(e,t,r){return this.create({userId:e,type:"warning",title:"Alerta de seguran\xe7a",message:r,data:{type:"security_alert",alertType:t}})}static async notifySystemMaintenance(e,t){return this.create({userId:e,type:"warning",title:"Manuten\xe7\xe3o programada",message:`Sistema em manuten\xe7\xe3o programada para ${t.toLocaleDateString("pt-BR")}`,data:{type:"maintenance",scheduledAt:t.toISOString()},expiresAt:t})}static async notifyDataExport(e,t,r){return this.create({userId:e,type:"completed"===r?"success":"error",title:"completed"===r?"Exporta\xe7\xe3o conclu\xedda":"Falha na exporta\xe7\xe3o",message:`Exporta\xe7\xe3o de ${t} ${"completed"===r?"foi conclu\xedda":"falhou"}`,data:{type:"export",exportType:t,status:r}})}static async broadcast(e){try{let t={...e,id:`global_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date,read:!1},r=this.GLOBAL_NOTIFICATIONS_KEY,s=await o.get(r)||[];s.unshift(t);let a=s.slice(0,10);await o.set(r,a,2592e3),console.log(`[NOTIFICATIONS] Notifica\xe7\xe3o global criada: ${e.title}`)}catch(e){console.error("[NOTIFICATIONS] Erro ao criar notifica\xe7\xe3o global:",e)}}static async getGlobalNotifications(){try{let e=this.GLOBAL_NOTIFICATIONS_KEY;return(await o.get(e)||[]).filter(e=>!e.expiresAt||new Date(e.expiresAt)>new Date)}catch(e){return console.error("[NOTIFICATIONS] Erro ao buscar notifica\xe7\xf5es globais:",e),[]}}}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39155:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>d,serverHooks:()=>y,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>p});var s={};r.r(s),r.d(s,{DELETE:()=>u,PUT:()=>l});var a=r(96559),i=r(48088),o=r(37719),n=r(32190),c=r(28617);async function l(e,t){try{let r=parseInt(e.headers.get("x-user-id")||"");if(!r)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o autenticado"},{status:401});let{id:s}=await t.params;if(!await c.J.markAsRead(r,s))return n.NextResponse.json({error:"Falha ao marcar notifica\xe7\xe3o como lida"},{status:500});return n.NextResponse.json({success:!0})}catch(e){return console.error("[API] Erro ao marcar notifica\xe7\xe3o como lida:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function u(e,t){try{let r=parseInt(e.headers.get("x-user-id")||"");if(!r)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o autenticado"},{status:401});let{id:s}=await t.params;if(!await c.J.delete(r,s))return n.NextResponse.json({error:"Falha ao deletar notifica\xe7\xe3o"},{status:500});return n.NextResponse.json({success:!0})}catch(e){return console.error("[API] Erro ao deletar notifica\xe7\xe3o:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/notifications/[id]/route",pathname:"/api/notifications/[id]",filename:"route",bundlePath:"app/api/notifications/[id]/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\notifications\\[id]\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:p,serverHooks:y}=d;function m(){return(0,o.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:p})}},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},83997:e=>{"use strict";e.exports=require("tty")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,580,300],()=>r(39155));module.exports=s})();