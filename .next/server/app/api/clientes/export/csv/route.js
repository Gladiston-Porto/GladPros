(()=>{var e={};e.id=3953,e.ids=[3953],e.modules={1708:e=>{"use strict";e.exports=require("node:process")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{"use strict";e.exports=require("node:tty")},7152:(e,o,t)=>{"use strict";t.d(o,{o0:()=>u,Bb:()=>v,a0:()=>f,pJ:()=>c});var i=t(24501),a=t(87624);function r(e){return a.qG(i.rS,e)}let n=/^(?:\+?\d[\d\s\-\(\)]{9,14})$/,s=/^(\d{5}|\d{5}-\d{3}|\d{5}-\d{4}|\d{8}|\d{5,9})$/,l=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,d=/^\d{3}-\d{2}-\d{4}$|^\d{9}$/,p=/^9\d{2}-\d{2}-\d{4}$|^9\d{8}$/,m=/^\d{2}-\d{7}$|^\d{9}$/,u=i.Ik({tipo:i.k5(["PF","PJ"],{message:"Tipo deve ser PF ou PJ"}),nomeCompleto:i.Yj().min(1,"Nome completo \xe9 obrigat\xf3rio").max(255).optional().nullable(),razaoSocial:i.Yj().max(255).optional().nullable(),nomeFantasia:i.Yj().max(255).optional().nullable(),email:i.Yj().min(1,"E-mail \xe9 obrigat\xf3rio").regex(l,"E-mail deve ter formato v\xe1lido").max(255),telefone:i.Yj().min(1,"Telefone \xe9 obrigat\xf3rio").regex(n,"Telefone deve ter formato v\xe1lido").transform(e=>e.replace(/\D/g,"")),tipoDocumentoPF:i.k5(["SSN","ITIN"]).optional().nullable(),ssn:i.vk(e=>""===e?void 0:e,i.Yj().regex(d,"SSN deve ter formato v\xe1lido (123-45-6789)").optional().nullable()),itin:i.vk(e=>""===e?void 0:e,i.Yj().regex(p,"ITIN deve ter formato v\xe1lido (9XX-XX-XXXX)").optional().nullable()),ein:i.vk(e=>""===e?void 0:e,i.Yj().regex(m,"EIN deve ter formato v\xe1lido (12-3456789)").optional().nullable()),endereco1:i.Yj().max(255).optional().nullable(),endereco2:i.Yj().max(255).optional().nullable(),cidade:i.Yj().max(96).optional().nullable(),estado:i.Yj().max(32).optional().nullable(),zipcode:i.vk(e=>""===e?void 0:e,i.Yj().regex(s,"CEP/ZIP deve ter formato v\xe1lido").transform(e=>e.replace(/\D/g,"")).optional().nullable()),observacoes:i.Yj().max(1e3).optional().nullable()}).refine(e=>"PF"===e.tipo?!!(e.nomeCompleto&&e.nomeCompleto.trim().length>0):"PJ"!==e.tipo||!!(e.nomeFantasia&&e.nomeFantasia.trim().length>0),{message:"Para PF o nome completo \xe9 obrigat\xf3rio, para PJ o nome da empresa \xe9 obrigat\xf3rio",path:["tipo"]}).refine(e=>{if("PF"===e.tipo&&e.tipoDocumentoPF){if("SSN"===e.tipoDocumentoPF&&e.ssn)return/^\d{3}-\d{2}-\d{4}$|^\d{9}$/.test(e.ssn);if("ITIN"===e.tipoDocumentoPF&&e.itin)return/^9\d{2}-\d{2}-\d{4}$|^9\d{8}$/.test(e.itin)}return"PJ"!==e.tipo||!e.ein||/^\d{2}-\d{7}$|^\d{9}$/.test(e.ein)},{message:"Documentos devem ter formato v\xe1lido quando fornecidos",path:["tipo"]}),c=i.Ik({tipo:i.k5(["PF","PJ"]).optional(),ativo:i.zM().optional(),nomeCompleto:i.Yj().max(255).optional().nullable(),razaoSocial:i.Yj().max(255).optional().nullable(),nomeFantasia:i.Yj().max(255).optional().nullable(),email:i.Yj().regex(l,"E-mail deve ter formato v\xe1lido").max(255).optional(),telefone:i.Yj().regex(n,"Telefone deve ter formato v\xe1lido").optional(),tipoDocumentoPF:i.k5(["SSN","ITIN"]).optional().nullable(),ssn:i.vk(e=>""===e?void 0:e,i.Yj().regex(d,"SSN deve ter formato v\xe1lido (123-45-6789)").optional().nullable()),itin:i.vk(e=>""===e?void 0:e,i.Yj().regex(p,"ITIN deve ter formato v\xe1lido (9XX-XX-XXXX)").optional().nullable()),ein:i.vk(e=>""===e?void 0:e,i.Yj().regex(m,"EIN deve ter formato v\xe1lido (12-3456789)").optional().nullable()),endereco1:i.Yj().max(255).optional().nullable(),endereco2:i.Yj().max(255).optional().nullable(),cidade:i.Yj().max(96).optional().nullable(),estado:i.Yj().max(32).optional().nullable(),zipcode:i.vk(e=>""===e?void 0:e,i.Yj().regex(s,"CEP/ZIP deve ter formato v\xe1lido").transform(e=>e.replace(/\D/g,"")).optional().nullable()),observacoes:i.Yj().max(1e3).optional().nullable()}).refine(e=>"PF"===e.tipo&&void 0!==e.nomeCompleto?!e.nomeCompleto||e.nomeCompleto.trim().length>0:"PJ"!==e.tipo||void 0===e.nomeFantasia||!e.nomeFantasia||e.nomeFantasia.trim().length>0,{message:"Nome completo (PF) ou nome da empresa (PJ) n\xe3o podem ser vazios se fornecidos",path:["tipo"]}).refine(e=>{if("PF"===e.tipo&&e.tipoDocumentoPF){if("SSN"===e.tipoDocumentoPF&&void 0!==e.ssn)return!e.ssn||/^\d{3}-\d{2}-\d{4}$|^\d{9}$/.test(e.ssn);if("ITIN"===e.tipoDocumentoPF&&void 0!==e.itin)return!e.itin||/^9\d{2}-\d{2}-\d{4}$|^9\d{8}$/.test(e.itin)}return"PJ"!==e.tipo||void 0===e.ein||!e.ein||/^\d{2}-\d{7}$|^\d{9}$/.test(e.ein)},{message:"Documentos devem ter formato v\xe1lido",path:["tipo"]}).transform(e=>{if(void 0!==e.telefone){if(""===e.telefone||null===e.telefone)e.telefone=void 0;else if(e.telefone=String(e.telefone).replace(/\D/g,""),!/^\d{7,15}$/.test(e.telefone))throw Error("Telefone deve ter entre 7 e 15 d\xedgitos")}return e}),v=i.Ik({q:i.Yj().optional(),tipo:i.k5(["PF","PJ","all"]).optional().default("all"),ativo:i.vk(e=>"true"===e||"false"!==e&&e,i.KC([i.zM(),i.eu("all")])).optional().default("all"),page:r().min(1).optional().default(1),pageSize:r().min(1).max(2e3).optional().default(10),sortKey:i.k5(["nome","tipo","email","telefone","documento","cidadeEstado","status"]).optional(),sortDir:i.k5(["asc","desc"]).optional()}),f=i.Ik({id:r().int().positive()}),x=i.Ik({id:i.ai(),tipo:i.k5(["PF","PJ"]),nomeCompletoOuRazao:i.Yj(),email:i.Yj(),telefone:i.Yj(),cidade:i.Yj().nullable(),estado:i.Yj().nullable(),zipcode:i.Yj().nullable(),documentoMasked:i.Yj(),ativo:i.zM(),criadoEm:i.Yj(),atualizadoEm:i.Yj()});i.Ik({data:i.YO(x),page:i.ai(),pageSize:i.ai(),total:i.ai(),totalPages:i.ai()})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13641:(e,o,t)=>{"use strict";t.d(o,{z:()=>i.z});var i=t(31183)},16698:e=>{"use strict";e.exports=require("node:async_hooks")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,o,t)=>{"use strict";t.d(o,{z:()=>a});var i=t(29942);let a=global.__prisma??new i.PrismaClient({log:["error"]})},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{"use strict";e.exports=require("node:os")},48787:(e,o,t)=>{"use strict";t.r(o),t.d(o,{patchFetch:()=>f,routeModule:()=>m,serverHooks:()=>v,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>c});var i={};t.r(i),t.d(i,{POST:()=>p});var a=t(96559),r=t(48088),n=t(37719),s=t(32190),l=t(13641),d=t(7152);async function p(e){if("phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE)return s.NextResponse.json({error:"Service temporarily unavailable"},{status:503});try{let o=await e.json().catch(()=>({})),t="string"==typeof o?.filename&&o.filename.trim()?o.filename:"clientes",i=Array.isArray(o?.clientes)?o.clientes:[];if(!i.length&&o?.filters){let e=d.Bb.partial().parse(o.filters),t=function(e){let o={};if(e?.q&&String(e.q).trim()){let t=String(e.q).trim();o.OR=[{nomeCompleto:{contains:t,mode:"insensitive"}},{razaoSocial:{contains:t,mode:"insensitive"}},{nomeFantasia:{contains:t,mode:"insensitive"}},{email:{contains:t,mode:"insensitive"}},{docLast4:{contains:t}}]}return e?.tipo&&"all"!==e.tipo&&(o.tipo=e.tipo),e?.ativo!==void 0&&"all"!==e.ativo&&(o.status=e.ativo?"ATIVO":"INATIVO"),o}(e);i=(await l.z.cliente.findMany({where:t,select:{id:!0,tipo:!0,nomeCompleto:!0,razaoSocial:!0,nomeFantasia:!0,email:!0,telefone:!0,cidade:!0,estado:!0,status:!0,criadoEm:!0},orderBy:[{status:"desc"},{atualizadoEm:"desc"}]})).map(e=>({id:e.id,nomeCompletoOuRazao:"PF"===e.tipo?e.nomeCompleto||"":e.nomeFantasia||e.razaoSocial||"",tipo:e.tipo,email:e.email,telefone:e.telefone,cidade:e.cidade??void 0,estado:e.estado??void 0,ativo:"ATIVO"===e.status,criadoEm:e.criadoEm.toISOString()}))}if(!i.length)return s.NextResponse.json({message:"Nenhum cliente para exportar"},{status:400});let a=["ID,Nome/Empresa,Tipo,E-mail,Telefone,Cidade,Estado,Status,Criado Em",...i.map(e=>[e.id,e.nomeCompletoOuRazao||"",e.tipo||"",e.email||"",e.telefone||"",e.cidade||"",e.estado||"",e.ativo?"Ativo":"Inativo",e.criadoEm?new Date(e.criadoEm).toLocaleDateString("pt-BR"):""].map(e=>`"${String(e??"").replace(/"/g,'""')}"`).join(","))].join("\n");return new s.NextResponse(a,{headers:{"Content-Type":"text/csv;charset=utf-8","Content-Disposition":`attachment; filename="${t}.csv"`}})}catch(e){return console.error("Erro ao gerar CSV de clientes:",e),s.NextResponse.json({message:"Erro interno do servidor"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/clientes/export/csv/route",pathname:"/api/clientes/export/csv",filename:"route",bundlePath:"app/api/clientes/export/csv/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\clientes\\export\\csv\\route.ts",nextConfigOutput:"standalone",userland:i}),{workAsyncStorage:u,workUnitAsyncStorage:c,serverHooks:v}=m;function f(){return(0,n.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:c})}},51455:e=>{"use strict";e.exports=require("node:fs/promises")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},78474:e=>{"use strict";e.exports=require("node:events")},96487:()=>{}};var o=require("../../../../../webpack-runtime.js");o.C(e);var t=e=>o(o.s=e),i=o.X(0,[7719,580,9942,4501],()=>t(48787));module.exports=i})();