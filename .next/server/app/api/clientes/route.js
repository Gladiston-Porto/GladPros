"use strict";(()=>{var e={};e.id=7147,e.ids=[7147],e.modules={1440:(e,t,o)=>{o.d(t,{M:()=>l});var r=o(44999),a=o(39916),n=o(48378),i=o(13641),s=o(29979);async function l(){let e=await (0,r.UL)(),t=e.get("authToken")?.value;if(!t)return(0,a.redirect)("/login");try{let e=await (0,n.S)(t),o=await i.z.$queryRaw`
      SELECT id, email, nomeCompleto, tokenVersion, status 
      FROM Usuario 
      WHERE id = ${Number(e.sub)} 
      LIMIT 1
    `;if(!o.length)return(0,a.redirect)("/login?e=user");let r=o[0];if(await (0,s.I)())try{let t=r.tokenVersion??0;if((e.tokenVersion??0)!==t)return(0,a.redirect)("/login?e=tokenver")}catch{}if("ATIVO"!==e.status||"ATIVO"!==r.status)return(0,a.redirect)("/login?e=inactive");return{id:String(e.sub),role:String(e.role??"USUARIO"),email:r.email||void 0,name:r.nomeCompleto||"Usu\xe1rio"}}catch{return(0,a.redirect)("/login?e=token")}}},1708:e=>{e.exports=require("node:process")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{e.exports=require("node:tty")},8704:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var o in t)Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}(t,{HTTPAccessErrorStatus:function(){return o},HTTP_ERROR_FALLBACK_ERROR_CODE:function(){return a},getAccessFallbackErrorTypeByStatus:function(){return s},getAccessFallbackHTTPStatus:function(){return i},isHTTPAccessFallbackError:function(){return n}});let o={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401},r=new Set(Object.values(o)),a="NEXT_HTTP_ERROR_FALLBACK";function n(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,o]=e.digest.split(";");return t===a&&r.has(Number(o))}function i(e){return Number(e.digest.split(";")[1])}function s(e){switch(e){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not-found";default:return}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16698:e=>{e.exports=require("node:async_hooks")},19015:(e,t,o)=>{o.d(t,{G4:()=>c,Jd:()=>d,Ku:()=>u,bj:()=>i,eA:()=>p,gz:()=>f,oZ:()=>l,sr:()=>s});var r=o(78910),a=o(13641),n=o(18260);function i(e,t){if(!e)return"";let o=e.replace(/\D/g,"");if(o.length<11&&"PF"===t||o.length<14&&"PJ"===t)return e;if(o.length<=4){let e=o.padStart(4,"*");return"PF"===t?`***-**-${e}`:`**-***${e}`}if("PF"===t){if(11===o.length)return`${o.slice(0,3)}.${o.slice(3,6)}.${o.slice(6,9)}-${o.slice(9)}`}else if(14===o.length)return`${o.slice(0,2)}.${o.slice(2,5)}.${o.slice(5,8)}/${o.slice(8,12)}-${o.slice(12)}`;return e}function s(e){if(!e)return"";let t=e.replace(/\D/g,"");return 11===t.length?`(${t.slice(0,2)}) ${t.slice(2,7)}-${t.slice(7)}`:10===t.length?`(${t.slice(0,2)}) ${t.slice(2,6)}-${t.slice(6)}`:e}function l(e){if(!e)return"";let t=e.replace(/\D/g,"");return 8===t.length||9===t.length?`${t.slice(0,5)}-${t.slice(5)}`:5===t.length?t:e}async function u(e,t){let o=await (0,r.is)(e);return{documentoEnc:o,docLast4:(0,r.nK)(e),docHash:(0,r.qZ)(e)}}function c(e){let t=e||{},o=e=>"string"==typeof e?e:null==e?null:String(e),r=o(t.nomeCompleto)?.trim()||null,a=o(t.razaoSocial)?.trim()||null,n=o(t.nomeFantasia)?.trim()||null,i=o(t.email)?.trim().toLowerCase()||null,s=o(t.telefone)?.replace(/\D/g,"")||null,l=t.tipoDocumentoPF??null,u=o(t.ssn)?o(t.ssn).replace(/\D/g,""):null,c=o(t.itin)?o(t.itin).replace(/\D/g,""):null,d=o(t.ein)?o(t.ein).replace(/\D/g,""):null,p=o(t.endereco1)?.trim()||null,f=o(t.endereco2)?.trim()||null,m=o(t.cidade)?.trim()||null,g=o(t.estado)?.trim()||null,E=o(t.zipcode)?.replace(/\D/g,"")||null,y=o(t.observacoes)?.trim()||null,v=o(t.documento)?.replace(/\D/g,"")||null;return{...t,nomeCompleto:r,razaoSocial:a,nomeFantasia:n,email:i,telefone:s,tipoDocumentoPF:l,ssn:u,itin:c,ein:d,endereco1:p,endereco2:f,cidade:m,estado:g,zipcode:E,documento:v,observacoes:y}}async function d(e,t){if(!e)return!1;let o=(0,r.qZ)(e);return!!a.z&&!!a.z.cliente&&"function"==typeof a.z.cliente.findFirst&&!!await a.z.cliente.findFirst({where:{docHash:o,id:t?{not:t}:void 0},select:{id:!0}})}async function p(e,t,o,r){return n.d.logAction(r,"Cliente",e,t,o)}function f(e,t){let o={};for(let r of["tipo","nomeCompleto","razaoSocial","nomeFantasia","email","telefone","endereco1","endereco2","cidade","estado","zipcode","observacoes","status"]){let a=e[r],n=t[r];a!==n&&(o[r]={old:a,new:n})}return e.docHash!==t.docHash&&(o.documento={old:"[DOCUMENTO]",new:"[DOCUMENTO ALTERADO]"}),o}},19121:e=>{e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31162:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isNextRouterError",{enumerable:!0,get:function(){return n}});let r=o(8704),a=o(49026);function n(e){return(0,a.isRedirectError)(e)||(0,r.isHTTPAccessFallbackError)(e)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},31421:e=>{e.exports=require("node:child_process")},33873:e=>{e.exports=require("path")},36654:(e,t,o)=>{o.r(t),o.d(t,{patchFetch:()=>R,routeModule:()=>v,serverHooks:()=>O,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>h});var r={};o.r(r),o.d(r,{GET:()=>E,POST:()=>y,runtime:()=>m});var a=o(96559),n=o(48088),i=o(37719),s=o(32190),l=o(13641),u=o(80969),c=o(1440),d=o(7152),p=o(19015),f=o(14250);let m="nodejs";function g(){return"phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE}async function E(e){if(g())return s.NextResponse.json({error:"Service temporarily unavailable"},{status:503});try{"function"==typeof u.lE&&await (0,u.lE)(e,"canRead");let{searchParams:t}=new URL(e.url),o=Object.fromEntries(t.entries()),r={...d.Bb.parse(o)},a=t.get("ativo");null===a?r.ativo="all":"true"===a?r.ativo=!0:"false"===a?r.ativo=!1:r.ativo=a;let n=[];if("all"===r.ativo?n.push({ativo:!0}):"boolean"==typeof r.ativo&&n.push({ativo:r.ativo}),r.q&&r.q.trim()){let e=r.q.trim();n.push({OR:[{nomeCompleto:{contains:e,mode:"insensitive"}},{razaoSocial:{contains:e,mode:"insensitive"}},{email:{contains:e,mode:"insensitive"}}]})}r.tipo&&"all"!==r.tipo&&n.push({tipo:r.tipo});let i=(r.page-1)*r.pageSize,c={criadoEm:"desc"};if(r.sortKey){let e="asc"===r.sortDir?"asc":"desc",t=[];switch(r.sortKey){case"nome":t.push({nomeChave:e});break;case"tipo":t.push({tipo:e});break;case"email":t.push({email:e});break;case"telefone":t.push({telefone:e});break;case"documento":t.push({docLast4:e});break;case"cidadeEstado":t.push({estado:e}),t.push({cidade:e});break;case"status":t.push({status:e})}c="status"!==r.sortKey?[{status:"desc"},...t]:t}let f=n.length>0?{AND:n}:{},[m,g]=await Promise.all([l.z.cliente.findMany({where:f,select:{id:!0,tipo:!0,nomeCompleto:!0,razaoSocial:!0,nomeFantasia:!0,email:!0,telefone:!0,cidade:!0,estado:!0,zipcode:!0,docLast4:!0,status:!0,criadoEm:!0,atualizadoEm:!0},orderBy:c,take:r.pageSize,skip:i}),l.z.cliente.count({where:f})]),E=m.map(e=>({id:e.id,tipo:e.tipo,nomeCompletoOuRazao:"PF"===e.tipo?e.nomeCompleto||"Nome n\xe3o informado":e.nomeFantasia||e.razaoSocial||"Raz\xe3o social n\xe3o informada",email:e.email,telefone:(0,p.sr)(e.telefone||""),cidade:e.cidade,estado:e.estado,zipcode:(0,p.oZ)(e.zipcode||""),documentoMasked:(0,p.bj)(e.docLast4||"",e.tipo),ativo:"ATIVO"===e.status,criadoEm:e.criadoEm.toISOString(),atualizadoEm:e.atualizadoEm.toISOString()})),y=Math.ceil(g/r.pageSize);return s.NextResponse.json({data:E,page:r.page,pageSize:r.pageSize,total:g,totalPages:y})}catch(e){if(console.error("[API] GET /api/clientes error:",e),e&&"P2002"===e.code&&e.meta&&Array.isArray(e.meta.target)&&e.meta.target.includes("email"))return s.NextResponse.json({error:"E-mail j\xe1 est\xe1 em uso"},{status:409});if(e instanceof f.G)return s.NextResponse.json({error:"Par\xe2metros inv\xe1lidos",details:e.issues},{status:400});if(e instanceof Error){if("UNAUTHENTICATED"===e.message)return s.NextResponse.json({error:"N\xe3o autenticado"},{status:401});if("FORBIDDEN"===e.message)return s.NextResponse.json({error:"Sem permiss\xe3o para listar clientes"},{status:403})}return s.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function y(e){if(g())return s.NextResponse.json({error:"Service temporarily unavailable"},{status:503});try{let t=null;if("function"==typeof u.lE)t=await (0,u.lE)(e,"canCreate");else try{t=await (0,c.M)()}catch{t={id:"0",role:"USUARIO"}}let o=await e.json(),r=d.o0.parse(o),a=(0,p.G4)(r),n=null;if("PF"===a.tipo?("SSN"===a.tipoDocumentoPF&&a.ssn&&(n=a.ssn),"ITIN"===a.tipoDocumentoPF&&a.itin&&(n=a.itin)):"PJ"===a.tipo&&a.ein&&(n=a.ein),n&&await (0,p.Jd)(n))return s.NextResponse.json({error:"Documento j\xe1 cadastrado no sistema"},{status:400});let i=l.z&&l.z.cliente&&"function"==typeof l.z.cliente.findFirst?await l.z.cliente.findFirst({where:{email:a.email},select:{id:!0,status:!0,tipo:!0}}):null;if(i&&"INATIVO"===i.status){if(n&&await (0,p.Jd)(n,i.id))return s.NextResponse.json({error:"Documento j\xe1 cadastrado no sistema"},{status:400});let e=null,o=null,r=null;if(n){let t=await (0,p.Ku)(n,a.tipo);e=t.documentoEnc,o=t.docLast4,r=t.docHash}let u=await l.z.cliente.update({where:{id:i.id},data:{tipo:a.tipo,nomeCompleto:a.nomeCompleto,razaoSocial:a.razaoSocial,nomeFantasia:a.nomeFantasia,telefone:a.telefone,nomeChave:"PF"===a.tipo?a.nomeCompleto||"":a.nomeFantasia||a.razaoSocial||"",documentoEnc:e??void 0,docLast4:o??void 0,docHash:r??void 0,endereco1:a.endereco1,endereco2:a.endereco2,cidade:a.cidade,estado:a.estado,zipcode:a.zipcode,observacoes:a.observacoes,status:"ATIVO"},select:{id:!0,tipo:!0,nomeCompleto:!0,razaoSocial:!0,nomeFantasia:!0,email:!0,telefone:!0,cidade:!0,estado:!0,zipcode:!0,docLast4:!0,status:!0,criadoEm:!0,atualizadoEm:!0}});await (0,p.eA)(u.id,"UPDATE",{status:{old:"INATIVO",new:"ATIVO"}},Number(t.id));let c={id:u.id,tipo:u.tipo,nomeCompletoOuRazao:"PF"===u.tipo?u.nomeCompleto||"Nome n\xe3o informado":u.nomeFantasia||u.razaoSocial||"Raz\xe3o social n\xe3o informada",email:u.email,telefone:(0,p.sr)(u.telefone||""),cidade:u.cidade,estado:u.estado,zipcode:(0,p.oZ)(u.zipcode||""),documentoMasked:(0,p.bj)(u.docLast4||"",u.tipo),ativo:"ATIVO"===u.status,criadoEm:u.criadoEm.toISOString(),atualizadoEm:u.atualizadoEm.toISOString()};return s.NextResponse.json(c,{status:200})}if(i)return s.NextResponse.json({error:"E-mail j\xe1 cadastrado no sistema"},{status:400});let f=null,m=null,g=null;if(n){let e=await (0,p.Ku)(n,a.tipo);f=e.documentoEnc,m=e.docLast4,g=e.docHash}let E=await l.z.cliente.create({data:{tipo:a.tipo,nomeCompleto:a.nomeCompleto,razaoSocial:a.razaoSocial,nomeFantasia:a.nomeFantasia,email:a.email,telefone:a.telefone,nomeChave:"PF"===a.tipo?a.nomeCompleto||"":a.nomeFantasia||a.razaoSocial||"",documentoEnc:f,docLast4:m||void 0,docHash:g||void 0,endereco1:a.endereco1,endereco2:a.endereco2,cidade:a.cidade,estado:a.estado,zipcode:a.zipcode,observacoes:a.observacoes,status:"ATIVO",atualizadoEm:new Date},select:{id:!0,tipo:!0,nomeCompleto:!0,razaoSocial:!0,nomeFantasia:!0,email:!0,telefone:!0,cidade:!0,estado:!0,zipcode:!0,docLast4:!0,status:!0,criadoEm:!0,atualizadoEm:!0}});await (0,p.eA)(E.id,"CREATE",{...a,documento:"[DOCUMENTO]"},Number(t.id));let y={id:E.id,tipo:E.tipo,nomeCompletoOuRazao:"PF"===E.tipo?E.nomeCompleto||"Nome n\xe3o informado":E.nomeFantasia||E.razaoSocial||"Raz\xe3o social n\xe3o informada",email:E.email,telefone:(0,p.sr)(E.telefone||""),cidade:E.cidade,estado:E.estado,zipcode:(0,p.oZ)(E.zipcode||""),documentoMasked:(0,p.bj)(E.docLast4||"",E.tipo),ativo:"ATIVO"===E.status,criadoEm:E.criadoEm.toISOString(),atualizadoEm:E.atualizadoEm.toISOString()};return s.NextResponse.json(y,{status:201})}catch(e){if(console.error("[API] POST /api/clientes error:",e),e&&"P2002"===e.code&&e.meta&&Array.isArray(e.meta.target)&&e.meta.target.includes("email"))return s.NextResponse.json({error:"E-mail j\xe1 est\xe1 em uso"},{status:409});if(e instanceof f.G)return s.NextResponse.json({error:"Dados inv\xe1lidos",details:e.issues},{status:400});if(e instanceof Error){if("UNAUTHENTICATED"===e.message)return s.NextResponse.json({error:"N\xe3o autenticado"},{status:401});if("FORBIDDEN"===e.message)return s.NextResponse.json({error:"Sem permiss\xe3o para criar clientes"},{status:403})}return s.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let v=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/clientes/route",pathname:"/api/clientes",filename:"route",bundlePath:"app/api/clientes/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\clientes\\route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:b,workUnitAsyncStorage:h,serverHooks:O}=v;function R(){return(0,i.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:h})}},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{e.exports=require("node:os")},49026:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var o in t)Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}(t,{REDIRECT_ERROR_CODE:function(){return a},RedirectType:function(){return n},isRedirectError:function(){return i}});let r=o(52836),a="NEXT_REDIRECT";var n=function(e){return e.push="push",e.replace="replace",e}({});function i(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let t=e.digest.split(";"),[o,n]=t,i=t.slice(2,-2).join(";"),s=Number(t.at(-2));return o===a&&("replace"===n||"push"===n)&&"string"==typeof i&&!isNaN(s)&&s in r.RedirectStatusCode}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},51455:e=>{e.exports=require("node:fs/promises")},51846:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var o in t)Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}(t,{BailoutToCSRError:function(){return r},isBailoutToCSRError:function(){return a}});let o="BAILOUT_TO_CLIENT_SIDE_RENDERING";class r extends Error{constructor(e){super("Bail out to client-side rendering: "+e),this.reason=e,this.digest=o}}function a(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===o}},52637:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isPostpone",{enumerable:!0,get:function(){return r}});let o=Symbol.for("react.postpone");function r(e){return"object"==typeof e&&null!==e&&e.$$typeof===o}},52836:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return o}});var o=function(e){return e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e}({});("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},76760:e=>{e.exports=require("node:path")},76926:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return l}});let r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=a(t);if(o&&o.has(e))return o.get(e);var r={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=n?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=e[i]}return r.default=e,o&&o.set(e,r),r}(o(61120));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(a=function(e){return e?o:t})(e)}let n={current:null},i="function"==typeof r.cache?r.cache:e=>e,s=console.warn;function l(e){return function(...t){s(e(...t))}}i(e=>{try{s(n.current)}finally{n.current=null}})},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},78910:(e,t,o)=>{o.d(t,{is:()=>l,nK:()=>p,qZ:()=>d,wz:()=>u});var r=o(77598),a=o.n(r);let n="PbE3VcAyP30aTLnd18EE947FvZ8ttn0YGPIEGtbMtsU=";if(!n)throw Error("Missing CLIENT_DOC_ENCRYPTION_KEY_BASE64");let i=Buffer.from(n,"base64");if(32!==i.length)throw Error("CLIENT_DOC_ENCRYPTION_KEY_BASE64 must decode to 32 bytes");let s="Ah72WaEOIS79EgFMo/7RcCsW0RgyEga2fKgsvzks0yk=".split(",").map(e=>e.trim()).filter(Boolean).map(e=>Buffer.from(e,"base64")).filter(e=>32===e.length);function l(e){let t=a().randomBytes(12),o=a().createCipheriv("aes-256-gcm",i,t),r=Buffer.concat([o.update(e,"utf8"),o.final()]),n=o.getAuthTag();return Buffer.concat([t,n,r]).toString("base64")}function u(e){let t=Buffer.from(e,"base64"),o=t.subarray(0,12),r=t.subarray(12,28),n=t.subarray(28);for(let e of[i,...s])try{let t=a().createDecipheriv("aes-256-gcm",e,o);return t.setAuthTag(r),Buffer.concat([t.update(n),t.final()]).toString("utf8")}catch{}throw Error("DECRYPT_FAILED")}function c(e){return e.replace(/[^0-9A-Za-z]/g,"").toUpperCase()}function d(e){let t=c(e);return a().createHash("sha256").update(t).digest("hex")}function p(e){return c(e).slice(-4)}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[7719,580,9942,4501,4553,6994,4629],()=>o(36654));module.exports=r})();