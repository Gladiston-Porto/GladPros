(()=>{var e={};e.id=6592,e.ids=[6592],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3575:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>P,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>v});var o={};r.r(o),r.d(o,{GET:()=>c});var a=r(96559),s=r(48088),n=r(37719),i=r(32190),u=r(78506);function p(e){return!!e.isClientView&&!!e.isAfterSignature||!e.isClientView&&!e.userPermissions.canViewInternalValues}function l(e){return null==e?e:"***.**"}async function c(e,{params:t}){try{let e=t.token;if(!e)return i.NextResponse.json({error:"Token n\xe3o fornecido"},{status:400});let r=await (0,u.SF)(e);if(!r)return i.NextResponse.json({error:"Proposta n\xe3o encontrada ou token expirado"},{status:404});let o=function(e,t=!1){return{canViewInternalValues:t||!1,canEdit:t||!1,canApprove:t||!1,canViewAllPropostas:t||!1,isAdmin:t,userId:e}}(void 0,!1),a={isClientView:!0,isAfterSignature:r?.status==="ASSINADA"||r?.status==="APROVADA",userPermissions:o},s=function(e,t){let r=p(t),o=!t.isClientView&&t.userPermissions.canViewInternalValues;return{...e,valorEstimado:r?l(e?.valorEstimado):e?.valorEstimado,precoPropostaCliente:r?l(e?.precoPropostaCliente):e?.precoPropostaCliente,internalEstimate:o?e?.internalEstimate:void 0,observacoesInternas:o?e?.observacoesInternas:void 0,criadoPor:o?e?.criadoPor:void 0,atualizadoPor:o?e?.atualizadoPor:void 0,etapas:e?.etapas?.map(e=>(function(e,t){let r=p(t);return{...e,custoMaoObraEstimado:r?l(e.custoMaoObraEstimado):e.custoMaoObraEstimado}})(e,t)),materiais:e?.materiais?.map(e=>(function(e,t){let r=p(t),o=(e.valorUnitario??0)*(e.quantidade??0);return{...e,valorUnitario:r?l(e.valorUnitario):e.valorUnitario,totalItem:r?l(o):o}})(e,t)),anexos:t.isClientView?e?.anexos?.filter(e=>!e.privado):e?.anexos,canViewInternalValues:t.userPermissions.canViewInternalValues,canEdit:t.userPermissions.canEdit,canApprove:t.userPermissions.canApprove}}(r,a);return i.NextResponse.json(s)}catch(e){return console.error("Error fetching proposal:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/client/proposta/[token]/route",pathname:"/api/client/proposta/[token]",filename:"route",bundlePath:"app/api/client/proposta/[token]/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\client\\proposta\\[token]\\route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:m,workUnitAsyncStorage:v,serverHooks:g}=d;function P(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:v})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33911:(e,t,r)=>{"use strict";r.d(t,{db:()=>n});class o{constructor(e){this.proposta={},this.propostaLog={},this.propostaEtapa={},this.propostaMaterial={},this.cliente={},this.usuario={}}$connect(){return Promise.resolve()}$disconnect(){return Promise.resolve()}$transaction(e){return e({})}generatePropostaNumber(){let e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),a=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return Promise.resolve(`PROP-${t}${r}${o}-${a}`)}}let a=globalThis;class s extends o{async generatePropostaNumber(){let e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),a=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return`PROP-${t}${r}${o}-${a}`}}let n=a.prisma??new s},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},78506:(e,t,r)=>{"use strict";r.d(t,{SF:()=>a}),r(55511);var o=r(33911);async function a(e){return e&&64===e.length?await o.db.proposta.findFirst({where:{tokenPublico:e,tokenExpiresAt:{gt:new Date},deletedAt:null,status:{in:["ENVIADA","ASSINADA"]}},include:{cliente:{select:{id:!0,nomeCompleto:!0,razaoSocial:!0,email:!0}},etapas:{orderBy:{ordem:"asc"}},materiais:{orderBy:{nome:"asc"}},anexos:{where:{privado:!1},orderBy:{criadoEm:"asc"}}}}):null}},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[7719,580],()=>r(3575));module.exports=o})();