(()=>{var e={};e.id=8857,e.ids=[8857],e.modules={1708:e=>{"use strict";e.exports=require("node:process")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{"use strict";e.exports=require("node:tty")},8086:e=>{"use strict";e.exports=require("module")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13641:(e,t,o)=>{"use strict";o.d(t,{z:()=>r.z});var r=o(31183)},16698:e=>{"use strict";e.exports=require("node:async_hooks")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,t,o)=>{"use strict";o.d(t,{z:()=>a});var r=o(29942);let a=global.__prisma??new r.PrismaClient({log:["error"]})},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{"use strict";e.exports=require("node:os")},51455:e=>{"use strict";e.exports=require("node:fs/promises")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},69812:(e,t,o)=>{"use strict";o.d(t,{B0:()=>c,Dm:()=>E,E9:()=>v,KS:()=>x,PQ:()=>k,X5:()=>m,Zk:()=>f,cQ:()=>A,if:()=>h,rf:()=>d,tT:()=>I,yp:()=>g});var r=o(24501);let a=r.Yj().email("Email inv\xe1lido").max(255,"Email muito longo").toLowerCase().trim(),i=r.Yj().min(6,"Senha deve ter pelo menos 6 caracteres").max(128,"Senha muito longa").refine(e=>!!/[a-z]/.test(e)&&!!/[A-Z0-9]/.test(e),"Senha deve conter pelo menos: 1 letra min\xfascula e 1 mai\xfascula ou n\xfamero"),s=r.Yj().min(2,"Nome deve ter pelo menos 2 caracteres").max(100,"Nome muito longo").trim().refine(e=>/^[a-zA-ZÀ-ÿ\s]+$/.test(e),"Nome deve conter apenas letras e espa\xe7os"),n=r.Yj().length(4,"PIN deve ter exatamente 4 d\xedgitos").refine(e=>/^\d{4}$/.test(e),"PIN deve conter apenas n\xfameros"),u=r.Yj().length(6,"C\xf3digo MFA deve ter exatamente 6 d\xedgitos").refine(e=>/^\d{6}$/.test(e),"C\xf3digo MFA deve conter apenas n\xfameros"),l=r.Yj().min(5,"Pergunta de seguran\xe7a muito curta").max(200,"Pergunta de seguran\xe7a muito longa").trim(),p=r.Yj().min(2,"Resposta muito curta").max(100,"Resposta muito longa").trim().toLowerCase(),m=r.Ik({email:a,password:r.Yj().min(1,"Senha \xe9 obrigat\xf3ria")}),d=r.Ik({userId:r.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),code:u,tipoAcao:r.k5(["LOGIN","PRIMEIRO_ACESSO","RESET_PASSWORD"]).optional()}),c=r.Ik({email:a});r.Ik({userId:r.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),novaSenha:i,pin:n,perguntaSeguranca:l,respostaSeguranca:p});let I=r.Ik({userId:r.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),newPassword:i,pin:n,securityQuestion:l,securityAnswer:p});r.Ik({token:r.Yj().min(1,"Token \xe9 obrigat\xf3rio"),novaSenha:i});let x=r.Ik({token:r.Yj().min(1,"Token \xe9 obrigat\xf3rio"),senha:i}),v=r.Ik({email:a}),E=r.Ik({email:a});r.Ik({nomeCompleto:s,email:a,tipo:r.k5(["ADMIN","USUARIO","CLIENTE"]),departamento:r.Yj().max(100,"Departamento muito longo").optional(),cargo:r.Yj().max(100,"Cargo muito longo").optional()}),r.Ik({nomeCompleto:s.optional(),email:a.optional(),tipo:r.k5(["ADMIN","USUARIO","CLIENTE"]).optional(),departamento:r.Yj().max(100,"Departamento muito longo").optional(),cargo:r.Yj().max(100,"Cargo muito longo").optional(),status:r.k5(["ATIVO","INATIVO","SUSPENSO"]).optional()}).refine(e=>Object.keys(e).length>0,"Pelo menos um campo deve ser fornecido para atualiza\xe7\xe3o");let g=r.gM("method",[r.Ik({method:r.eu("pin"),userId:r.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),pin:n}),r.Ik({method:r.eu("security"),userId:r.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),answer:p})]),f=r.Ik({userId:r.ai().int().positive("ID do usu\xe1rio inv\xe1lido"),tipoAcao:r.k5(["LOGIN","PRIMEIRO_ACESSO","RESET_PASSWORD","RESET","DESBLOQUEIO"]).optional()}),S=r.Ik({nomeCompleto:r.Yj().optional(),email:a,role:r.Yj().optional(),ativo:r.zM().optional(),criadoEm:r.KC([r.Yj(),r.ai(),r.p6()]).optional()}),h=r.Ik({filename:r.Yj().min(1).max(128).optional(),users:r.YO(S).min(1)}),A=r.Ik({email:a.optional(),nomeCompleto:s.optional(),role:r.k5(["ADMIN","GERENTE","USUARIO","FINANCEIRO","ESTOQUE","CLIENTE"]).optional(),status:r.k5(["ATIVO","INATIVO"]).optional(),telefone:r.Yj().max(32).optional().or(r.eu("")).transform(e=>e||void 0).refine(e=>{if(!e)return!0;let t=e.replace(/\D/g,"");return t.length>=10&&t.length<=11},"Telefone deve ter entre 10 e 11 d\xedgitos. Exemplo: (11)99999-9999"),dataNascimento:r.KC([r.Yj(),r.p6()]).optional().transform(e=>{if(!e)return;if(e instanceof Date){if(isNaN(e.getTime()))return;let t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${r}`}let t=String(e).trim();if(t.match(/^(\d{4})-(\d{2})-(\d{2})$/))return t;let o=t.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(o){let[,e,t,r]=o,a=parseInt(t,10),i=parseInt(e,10);if(i<1||i>12||a<1||a>31)return"INVALID_DATE";let s=t.padStart(2,"0"),n=e.padStart(2,"0");return`${r}-${n}-${s}`}return"INVALID_DATE"}).refine(e=>!e||"INVALID_DATE"!==e&&!isNaN(new Date(e+"T00:00:00.000Z").getTime()),"Data de nascimento inv\xe1lida. Use o formato MM/DD/YYYY (ex: 05/18/1979)"),endereco1:r.Yj().max(191).optional().or(r.eu("")).transform(e=>e||void 0),endereco2:r.Yj().max(191).optional().or(r.eu("")).transform(e=>e||void 0),cidade:r.Yj().max(96).optional().or(r.eu("")).transform(e=>e||void 0),estado:r.Yj().max(32).optional().or(r.eu("")).transform(e=>e||void 0),cep:r.Yj().max(16).optional().or(r.eu("")).transform(e=>e||void 0).refine(e=>{if(!e)return!0;let t=e.replace(/\D/g,"");return t.length>=5&&t.length<=9&&t===e.replace(/\D/g,"")},"CEP deve conter apenas n\xfameros. Exemplo: 01234567"),anotacoes:r.Yj().optional().or(r.eu("")).transform(e=>e&&e.trim().length>0?e:void 0)}),k=r.Ik({ativo:r.zM()})},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},78474:e=>{"use strict";e.exports=require("node:events")},87156:(e,t,o)=>{"use strict";o.r(t),o.d(t,{patchFetch:()=>f,routeModule:()=>x,serverHooks:()=>g,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>E});var r={};o.r(r),o.d(r,{POST:()=>I});var a=o(96559),i=o(48088),s=o(37719),n=o(32190),u=o(80137),l=o(69812),p=o(24501),m=o(13641);async function d(e,t=2,o=300){let r;for(let a=0;a<=t;a++)try{return await e()}catch(e){r=e,await new Promise(e=>setTimeout(e,o))}throw r}let c=p.Ik({q:p.Yj().optional(),role:p.k5(["ADMIN","GERENTE","USUARIO","FINANCEIRO","ESTOQUE","CLIENTE"]).optional(),status:p.k5(["ATIVO","INATIVO"]).optional(),sortKey:p.k5(["nome","email","role","ativo","criadoEm"]).optional(),sortDir:p.k5(["asc","desc"]).optional()}).optional();async function I(e){if("phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE)return n.NextResponse.json({error:"Service temporarily unavailable"},{status:503});try{let t=await e.json().catch(()=>({})),o=l.if.safeParse(t),r=p.Ik({filename:p.Yj().optional(),filters:c}).safeParse(t);if(!o.success&&!r.success)return n.NextResponse.json({message:"Payload inv\xe1lido para exporta\xe7\xe3o"},{status:400});let a=(o.success?o.data.filename:r.success?r.data.filename:void 0)||"usuarios",i=o.success?o.data.users:[];if(!o.success&&r.success){let e=r.data.filters??{},t=[],o=[];if(e.q){let r=`%${e.q}%`;t.push("(email LIKE ? OR nomeCompleto LIKE ? OR nome LIKE ?)"),o.push(r,r,r)}e.role&&(t.push("(role = ? OR nivel = ?)"),o.push(e.role,e.role)),e.status&&(t.push("status = ?"),o.push(e.status));let a=t.length?`WHERE ${t.join(" AND ")}`:"",s=(()=>{switch(e.sortKey){case"nome":return"COALESCE(nomeCompleto, nome)";case"email":return"email";case"role":return"COALESCE(role, nivel)";case"ativo":return"status";default:return"criadoEm"}})(),n=e.sortDir&&"ASC"===e.sortDir.toUpperCase()?"ASC":"DESC",u=`SELECT * FROM Usuario ${a} ORDER BY ${s} ${n}`;i=(await d(()=>m.z.$queryRawUnsafe(u,...o))).map(e=>({nomeCompleto:e.nome??e.nomeCompleto??"",email:e.email,role:e.role??e.nivel??void 0,ativo:(e.status??"")==="ATIVO",criadoEm:e.criadoEm??void 0}))}let s=new u.Ay;s.setFont("helvetica"),s.setFontSize(16),s.text("Relat\xf3rio de Usu\xe1rios",20,20),s.setFontSize(10),s.text(`Gerado em: ${new Date().toLocaleDateString("pt-BR")} \xe0s ${new Date().toLocaleTimeString("pt-BR")}`,20,30),s.text(`Total de usu\xe1rios: ${i.length}`,20,35);let I=50;s.setFontSize(8),s.setFont("helvetica","bold"),s.text("Nome",20,I),s.text("E-mail",70,I),s.text("N\xedvel",120,I),s.text("Status",150,I),s.text("Criado",170,I),I+=6,s.line(20,I,190,I),I+=3,s.setFont("helvetica","normal"),i.forEach(e=>{I>270&&(s.addPage(),I=20);let t=(e.nomeCompleto||"").substring(0,25),o=(e.email||"").substring(0,25),r=e.role||"",a=e.ativo?"Ativo":"Inativo",i=e.criadoEm?new Date(e.criadoEm).toLocaleDateString("pt-BR"):"";s.text(t,20,I),s.text(o,70,I),s.text(r,120,I),s.text(a,150,I),s.text(i,170,I),I+=6});let x=Buffer.from(s.output("arraybuffer"));return new n.NextResponse(x,{headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="${a}.pdf"`}})}catch(e){return console.error("Erro ao gerar PDF:",e),n.NextResponse.json({message:"Erro interno do servidor"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/usuarios/export/pdf/route",pathname:"/api/usuarios/export/pdf",filename:"route",bundlePath:"app/api/usuarios/export/pdf/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\usuarios\\export\\pdf\\route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:v,workUnitAsyncStorage:E,serverHooks:g}=x;function f(){return(0,s.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:E})}},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[7719,580,9942,4501,137],()=>o(87156));module.exports=r})();