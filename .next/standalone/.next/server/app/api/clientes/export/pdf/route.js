(()=>{var e={};e.id=8935,e.ids=[8935],e.modules={1708:e=>{"use strict";e.exports=require("node:process")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{"use strict";e.exports=require("node:tty")},7152:(e,t,o)=>{"use strict";o.d(t,{o0:()=>u,Bb:()=>v,a0:()=>f,pJ:()=>c});var i=o(24501),a=o(87624);function r(e){return a.qG(i.rS,e)}let n=/^(?:\+?\d[\d\s\-\(\)]{9,14})$/,s=/^(\d{5}|\d{5}-\d{3}|\d{5}-\d{4}|\d{8}|\d{5,9})$/,l=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,d=/^\d{3}-\d{2}-\d{4}$|^\d{9}$/,p=/^9\d{2}-\d{2}-\d{4}$|^9\d{8}$/,m=/^\d{2}-\d{7}$|^\d{9}$/,u=i.Ik({tipo:i.k5(["PF","PJ"],{message:"Tipo deve ser PF ou PJ"}),nomeCompleto:i.Yj().min(1,"Nome completo \xe9 obrigat\xf3rio").max(255).optional().nullable(),razaoSocial:i.Yj().max(255).optional().nullable(),nomeFantasia:i.Yj().max(255).optional().nullable(),email:i.Yj().min(1,"E-mail \xe9 obrigat\xf3rio").regex(l,"E-mail deve ter formato v\xe1lido").max(255),telefone:i.Yj().min(1,"Telefone \xe9 obrigat\xf3rio").regex(n,"Telefone deve ter formato v\xe1lido").transform(e=>e.replace(/\D/g,"")),tipoDocumentoPF:i.k5(["SSN","ITIN"]).optional().nullable(),ssn:i.vk(e=>""===e?void 0:e,i.Yj().regex(d,"SSN deve ter formato v\xe1lido (123-45-6789)").optional().nullable()),itin:i.vk(e=>""===e?void 0:e,i.Yj().regex(p,"ITIN deve ter formato v\xe1lido (9XX-XX-XXXX)").optional().nullable()),ein:i.vk(e=>""===e?void 0:e,i.Yj().regex(m,"EIN deve ter formato v\xe1lido (12-3456789)").optional().nullable()),endereco1:i.Yj().max(255).optional().nullable(),endereco2:i.Yj().max(255).optional().nullable(),cidade:i.Yj().max(96).optional().nullable(),estado:i.Yj().max(32).optional().nullable(),zipcode:i.vk(e=>""===e?void 0:e,i.Yj().regex(s,"CEP/ZIP deve ter formato v\xe1lido").transform(e=>e.replace(/\D/g,"")).optional().nullable()),observacoes:i.Yj().max(1e3).optional().nullable()}).refine(e=>"PF"===e.tipo?!!(e.nomeCompleto&&e.nomeCompleto.trim().length>0):"PJ"!==e.tipo||!!(e.nomeFantasia&&e.nomeFantasia.trim().length>0),{message:"Para PF o nome completo \xe9 obrigat\xf3rio, para PJ o nome da empresa \xe9 obrigat\xf3rio",path:["tipo"]}).refine(e=>{if("PF"===e.tipo&&e.tipoDocumentoPF){if("SSN"===e.tipoDocumentoPF&&e.ssn)return/^\d{3}-\d{2}-\d{4}$|^\d{9}$/.test(e.ssn);if("ITIN"===e.tipoDocumentoPF&&e.itin)return/^9\d{2}-\d{2}-\d{4}$|^9\d{8}$/.test(e.itin)}return"PJ"!==e.tipo||!e.ein||/^\d{2}-\d{7}$|^\d{9}$/.test(e.ein)},{message:"Documentos devem ter formato v\xe1lido quando fornecidos",path:["tipo"]}),c=i.Ik({tipo:i.k5(["PF","PJ"]).optional(),ativo:i.zM().optional(),nomeCompleto:i.Yj().max(255).optional().nullable(),razaoSocial:i.Yj().max(255).optional().nullable(),nomeFantasia:i.Yj().max(255).optional().nullable(),email:i.Yj().regex(l,"E-mail deve ter formato v\xe1lido").max(255).optional(),telefone:i.Yj().regex(n,"Telefone deve ter formato v\xe1lido").optional(),tipoDocumentoPF:i.k5(["SSN","ITIN"]).optional().nullable(),ssn:i.vk(e=>""===e?void 0:e,i.Yj().regex(d,"SSN deve ter formato v\xe1lido (123-45-6789)").optional().nullable()),itin:i.vk(e=>""===e?void 0:e,i.Yj().regex(p,"ITIN deve ter formato v\xe1lido (9XX-XX-XXXX)").optional().nullable()),ein:i.vk(e=>""===e?void 0:e,i.Yj().regex(m,"EIN deve ter formato v\xe1lido (12-3456789)").optional().nullable()),endereco1:i.Yj().max(255).optional().nullable(),endereco2:i.Yj().max(255).optional().nullable(),cidade:i.Yj().max(96).optional().nullable(),estado:i.Yj().max(32).optional().nullable(),zipcode:i.vk(e=>""===e?void 0:e,i.Yj().regex(s,"CEP/ZIP deve ter formato v\xe1lido").transform(e=>e.replace(/\D/g,"")).optional().nullable()),observacoes:i.Yj().max(1e3).optional().nullable()}).refine(e=>"PF"===e.tipo&&void 0!==e.nomeCompleto?!e.nomeCompleto||e.nomeCompleto.trim().length>0:"PJ"!==e.tipo||void 0===e.nomeFantasia||!e.nomeFantasia||e.nomeFantasia.trim().length>0,{message:"Nome completo (PF) ou nome da empresa (PJ) n\xe3o podem ser vazios se fornecidos",path:["tipo"]}).refine(e=>{if("PF"===e.tipo&&e.tipoDocumentoPF){if("SSN"===e.tipoDocumentoPF&&void 0!==e.ssn)return!e.ssn||/^\d{3}-\d{2}-\d{4}$|^\d{9}$/.test(e.ssn);if("ITIN"===e.tipoDocumentoPF&&void 0!==e.itin)return!e.itin||/^9\d{2}-\d{2}-\d{4}$|^9\d{8}$/.test(e.itin)}return"PJ"!==e.tipo||void 0===e.ein||!e.ein||/^\d{2}-\d{7}$|^\d{9}$/.test(e.ein)},{message:"Documentos devem ter formato v\xe1lido",path:["tipo"]}).transform(e=>{if(void 0!==e.telefone){if(""===e.telefone||null===e.telefone)e.telefone=void 0;else if(e.telefone=String(e.telefone).replace(/\D/g,""),!/^\d{7,15}$/.test(e.telefone))throw Error("Telefone deve ter entre 7 e 15 d\xedgitos")}return e}),v=i.Ik({q:i.Yj().optional(),tipo:i.k5(["PF","PJ","all"]).optional().default("all"),ativo:i.vk(e=>"true"===e||"false"!==e&&e,i.KC([i.zM(),i.eu("all")])).optional().default("all"),page:r().min(1).optional().default(1),pageSize:r().min(1).max(2e3).optional().default(10),sortKey:i.k5(["nome","tipo","email","telefone","documento","cidadeEstado","status"]).optional(),sortDir:i.k5(["asc","desc"]).optional()}),f=i.Ik({id:r().int().positive()}),x=i.Ik({id:i.ai(),tipo:i.k5(["PF","PJ"]),nomeCompletoOuRazao:i.Yj(),email:i.Yj(),telefone:i.Yj(),cidade:i.Yj().nullable(),estado:i.Yj().nullable(),zipcode:i.Yj().nullable(),documentoMasked:i.Yj(),ativo:i.zM(),criadoEm:i.Yj(),atualizadoEm:i.Yj()});i.Ik({data:i.YO(x),page:i.ai(),pageSize:i.ai(),total:i.ai(),totalPages:i.ai()})},8086:e=>{"use strict";e.exports=require("module")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13641:(e,t,o)=>{"use strict";o.d(t,{z:()=>i.z});var i=o(31183)},16698:e=>{"use strict";e.exports=require("node:async_hooks")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,t,o)=>{"use strict";o.d(t,{z:()=>a});var i=o(29942);let a=global.__prisma??new i.PrismaClient({log:["error"]})},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{"use strict";e.exports=require("node:os")},51455:e=>{"use strict";e.exports=require("node:fs/promises")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71625:(e,t,o)=>{"use strict";o.r(t),o.d(t,{patchFetch:()=>x,routeModule:()=>u,serverHooks:()=>f,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>v});var i={};o.r(i),o.d(i,{POST:()=>m});var a=o(96559),r=o(48088),n=o(37719),s=o(32190),l=o(80137),d=o(13641),p=o(7152);async function m(e){if("phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE)return s.NextResponse.json({error:"Service temporarily unavailable"},{status:503});try{let t=await e.json().catch(()=>({})),o="string"==typeof t?.filename&&t.filename.trim()?t.filename:"clientes",i=Array.isArray(t?.clientes)?t.clientes:[];if(!i.length&&t?.filters){let e=p.Bb.partial().parse(t.filters),o=function(e){let t={};if(e?.q&&String(e.q).trim()){let o=String(e.q).trim();t.OR=[{nomeCompleto:{contains:o,mode:"insensitive"}},{razaoSocial:{contains:o,mode:"insensitive"}},{nomeFantasia:{contains:o,mode:"insensitive"}},{email:{contains:o,mode:"insensitive"}},{docLast4:{contains:o}}]}return e?.tipo&&"all"!==e.tipo&&(t.tipo=e.tipo),e?.ativo!==void 0&&"all"!==e.ativo&&(t.status=e.ativo?"ATIVO":"INATIVO"),t}(e);i=(await d.z.cliente.findMany({where:o,select:{id:!0,tipo:!0,nomeCompleto:!0,razaoSocial:!0,nomeFantasia:!0,email:!0,telefone:!0,cidade:!0,estado:!0,status:!0,criadoEm:!0},orderBy:[{status:"desc"},{atualizadoEm:"desc"}]})).map(e=>({id:e.id,nomeCompletoOuRazao:"PF"===e.tipo?e.nomeCompleto||"":e.nomeFantasia||e.razaoSocial||"",email:e.email,tipo:e.tipo,telefone:e.telefone,cidade:e.cidade||void 0,estado:e.estado||void 0,ativo:"ATIVO"===e.status,criadoEm:e.criadoEm.toISOString()}))}if(!i.length)return s.NextResponse.json({message:"Nenhum cliente para exportar"},{status:400});let a=new l.Ay;a.setFont("helvetica"),a.setFontSize(16),a.text("Relat\xf3rio de Clientes",20,20),a.setFontSize(10),a.text(`Gerado em: ${new Date().toLocaleDateString("pt-BR")} \xe0s ${new Date().toLocaleTimeString("pt-BR")}`,20,30),a.text(`Total de clientes: ${i.length}`,20,35);let r=50;a.setFontSize(8),a.setFont("helvetica","bold"),a.text("Nome/Empresa",20,r),a.text("Tipo",80,r),a.text("E-mail",100,r),a.text("Telefone",150,r),a.text("Status",180,r),r+=6,a.line(20,r,190,r),r+=3,a.setFont("helvetica","normal"),i.forEach(e=>{r>270&&(a.addPage(),r=20);let t=(e.nomeCompletoOuRazao||"").substring(0,40),o=e.tipo||"",i=(e.email||"").substring(0,30),n=(e.telefone||"")?.substring(0,18),s=e.ativo?"Ativo":"Inativo";a.text(t,20,r),a.text(o,80,r),a.text(i,100,r),a.text(n,150,r),a.text(s,180,r),r+=6});let n=Buffer.from(a.output("arraybuffer"));return new s.NextResponse(n,{headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="${o}.pdf"`}})}catch(e){return console.error("Erro ao gerar PDF de clientes:",e),s.NextResponse.json({message:"Erro interno do servidor"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/clientes/export/pdf/route",pathname:"/api/clientes/export/pdf",filename:"route",bundlePath:"app/api/clientes/export/pdf/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\clientes\\export\\pdf\\route.ts",nextConfigOutput:"standalone",userland:i}),{workAsyncStorage:c,workUnitAsyncStorage:v,serverHooks:f}=u;function x(){return(0,n.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:v})}},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},78474:e=>{"use strict";e.exports=require("node:events")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),i=t.X(0,[7719,580,9942,4501,137],()=>o(71625));module.exports=i})();