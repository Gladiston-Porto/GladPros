(()=>{var e={};e.id=8489,e.ids=[8489],e.modules={1708:e=>{"use strict";e.exports=require("node:process")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{"use strict";e.exports=require("node:tty")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13641:(e,r,t)=>{"use strict";t.d(r,{z:()=>s.z});var s=t(31183)},16698:e=>{"use strict";e.exports=require("node:async_hooks")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29979:(e,r,t)=>{"use strict";t.d(r,{I:()=>a});var s=t(13641);let o=null,i=0;async function a(){let e=Date.now();if(null!==o&&e-i<6e4)return o;try{let r=await s.z.$queryRaw`
      SELECT COUNT(*) AS cnt
      FROM INFORMATION_SCHEMA.COLUMNS
      WHERE TABLE_SCHEMA = DATABASE()
        AND TABLE_NAME = 'Usuario'
        AND COLUMN_NAME = 'tokenVersion'
    `;return o=(r?.[0]?.cnt??0)>0,i=e,o}catch{return o=!1,i=e,!1}}},31183:(e,r,t)=>{"use strict";t.d(r,{z:()=>o});var s=t(29942);let o=global.__prisma??new s.PrismaClient({log:["error"]})},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{"use strict";e.exports=require("node:os")},48378:(e,r,t)=>{"use strict";t.d(r,{S:()=>u,z:()=>n});var s=t(87806),o=t(77412);let i=null;function a(){if(!i){let e="g5QZk5uXmGBy1267sLdrd8FHIzUqEtUrxnyJqoWYEqPklmXS1YiLp0ervYW7C017";if(e){if(e.length<32)throw Error("JWT_SECRET deve ter pelo menos 32 caracteres");i=new TextEncoder().encode(e)}else if("phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE||"phase-development-build"===process.env.NEXT_PHASE)console.warn("[JWT] Usando secret tempor\xe1rio durante build. Certifique-se de definir JWT_SECRET em produ\xe7\xe3o."),i=new TextEncoder().encode("temporary-build-secret-will-be-replaced-at-runtime-32-chars-minimum");else throw Error("Missing JWT_SECRET environment variable. Certifique-se de definir esta vari\xe1vel em .env.local")}return i}async function n(e,r="7d"){return await new s.P({role:e.role,status:e.status,tokenVersion:e.tokenVersion}).setProtectedHeader({alg:"HS256"}).setSubject(e.sub).setIssuer("gladpros").setAudience("gladpros-app").setExpirationTime(r).sign(a())}async function u(e){let{payload:r}=await (0,o.V)(e,a(),{issuer:"gladpros",audience:"gladpros-app"});return r}},51455:e=>{"use strict";e.exports=require("node:fs/promises")},55511:e=>{"use strict";e.exports=require("crypto")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71940:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>m,routeModule:()=>h,serverHooks:()=>v,workAsyncStorage:()=>E,workUnitAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{POST:()=>l,runtime:()=>d});var o=t(96559),i=t(48088),a=t(37719),n=t(32190),u=t(13641),p=t(48378),c=t(29979);let d="nodejs";async function l(e){if("phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE)return n.NextResponse.json({error:"Service temporarily unavailable"},{status:503});try{let r=e.headers.get("cookie")??void 0,s=r?.split(";").map(e=>e.trim()).find(e=>e.startsWith("sessionToken="))?.split("=")[1],o=r?.split(";").map(e=>e.trim()).find(e=>e.startsWith("authToken="))?.split("=")[1],i=e.headers.get("authorization")??void 0,a=i?.startsWith("Bearer ")?i.slice(7):void 0,n=o??a;if(s)try{let{SecurityService:e}=await Promise.all([t.e(8318),t.e(2833)]).then(t.bind(t,92833));await e.revokeSessionByToken(s)}catch(e){console.warn("[Logout] Falha ao revogar sess\xe3o por token:",e)}if(n)try{let e=await (0,p.S)(n),r=Number(e.sub),t=await (0,c.I)();if(!Number.isNaN(r)&&t)try{await u.z.$executeRaw`UPDATE Usuario SET tokenVersion = tokenVersion + 1 WHERE id = ${r}`}catch{}}catch{}}catch(e){console.warn("[Logout] Falha ao processar cookies:",e)}let r=n.NextResponse.json({message:"Logout realizado com sucesso"});return r.cookies.set("authToken","",{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:0}),r.cookies.set("sessionToken","",{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:0}),r}let h=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/logout/route",pathname:"/api/auth/logout",filename:"route",bundlePath:"app/api/auth/logout/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\auth\\logout\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:E,workUnitAsyncStorage:x,serverHooks:v}=h;function m(){return(0,a.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:x})}},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},78474:e=>{"use strict";e.exports=require("node:events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7719,580,9942,4553],()=>t(71940));module.exports=s})();