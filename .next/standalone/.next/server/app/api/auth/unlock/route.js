"use strict";(()=>{var e={};e.id=9463,e.ids=[9463],e.modules={1708:e=>{e.exports=require("node:process")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{e.exports=require("node:tty")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16698:e=>{e.exports=require("node:async_hooks")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{e.exports=require("node:child_process")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{e.exports=require("node:os")},51455:e=>{e.exports=require("node:fs/promises")},55511:e=>{e.exports=require("crypto")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},76760:e=>{e.exports=require("node:path")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},92471:(e,r,o)=>{o.r(r),o.d(r,{patchFetch:()=>h,routeModule:()=>x,serverHooks:()=>v,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>g});var s={};o.r(s),o.d(s,{POST:()=>l});var t=o(96559),n=o(48088),a=o(37719),i=o(32190),u=o(13641),p=o(35508),c=o(30776),d=o(69812);async function l(e){if("phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE)return i.NextResponse.json({error:"Service temporarily unavailable"},{status:503});try{let r,o=await e.json().catch(()=>({})),s=d.yp.safeParse(o);if(!s.success)return i.NextResponse.json({error:"Dados inv\xe1lidos para desbloqueio"},{status:400});let{method:t,userId:n}=s.data,a=(await u.z.$queryRaw`
      SELECT id, email, nomeCompleto, bloqueado
      FROM Usuario 
      WHERE id = ${n}
      LIMIT 1
    `)[0];if(!a)return i.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});if(!a.bloqueado)return i.NextResponse.json({error:"Usu\xe1rio n\xe3o est\xe1 bloqueado"},{status:400});if("pin"===t){let{pin:e}=s.data;if(!e)return i.NextResponse.json({error:"PIN \xe9 obrigat\xf3rio"},{status:400});r=await p.BlockingService.unlockWithPin(n,e)}else{let{answer:e}=s.data;if(!e)return i.NextResponse.json({error:"Resposta de seguran\xe7a \xe9 obrigat\xf3ria"},{status:400});r=await p.BlockingService.unlockWithSecurityQuestion(n,e)}if(!r.success)return await c.g.logLogin(n,a.email,e,!1,{action:"unlock_attempt",method:t,reason:r.error}),i.NextResponse.json({error:r.error},{status:401});return await c.g.logLogin(n,a.email,e,!0,{action:"unlock_success",method:t,unlockedAt:new Date().toISOString()}),i.NextResponse.json({success:!0,message:"Conta desbloqueada com sucesso"})}catch(e){return console.error("[API] Unlock error:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let x=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/unlock/route",pathname:"/api/auth/unlock",filename:"route",bundlePath:"app/api/auth/unlock/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\auth\\unlock\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:q,workUnitAsyncStorage:g,serverHooks:v}=x;function h(){return(0,a.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:g})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),s=r.X(0,[7719,580,9942,4501,7378],()=>o(92471));module.exports=s})();