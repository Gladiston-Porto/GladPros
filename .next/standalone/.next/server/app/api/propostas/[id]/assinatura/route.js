(()=>{var e={};e.id=1761,e.ids=[1761],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3815:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>v,routeModule:()=>m,serverHooks:()=>h,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>x});var r={};s.r(r),s.d(r,{POST:()=>l});var a=s(96559),o=s(48088),n=s(37719),i=s(32190),u=s(24501),p=s(14250),d=s(33911);let c=u.Ik({assinaturaTipo:u.k5(["DIGITAL_DESENHADA","DIGITAL_NOME"]),assinaturaNome:u.Yj().min(1,"Nome da assinatura \xe9 obrigat\xf3rio"),assinaturaImagem:u.Yj().optional(),observacoes:u.Yj().optional(),consentimento:u.zM(),termosAceitos:u.zM()});async function l(e,{params:t}){try{let s=t.id,r=await e.json(),a=c.parse(r);if(!a.consentimento)return i.NextResponse.json({error:"Consentimento \xe9 obrigat\xf3rio"},{status:400});if(!a.termosAceitos)return i.NextResponse.json({error:"Aceita\xe7\xe3o dos termos \xe9 obrigat\xf3ria"},{status:400});let o=await d.db.proposta.findUnique({where:{id:s}});if(!o)return i.NextResponse.json({error:"Proposta n\xe3o encontrada"},{status:404});if(o.assinadoEm)return i.NextResponse.json({error:"Proposta j\xe1 est\xe1 assinada"},{status:400});let n=e.headers.get("user-agent")||"Unknown",u=e.headers.get("x-forwarded-for"),p=e.headers.get("x-real-ip"),l=await d.db.proposta.update({where:{id:s},data:{assinaturaTipo:a.assinaturaTipo,assinaturaNome:a.assinaturaNome,assinaturaImagem:a.assinaturaImagem,assinaturaIp:u||p||"Unknown",assinaturaUserAgent:n,assinadoEm:new Date,status:"AGUARDANDO_APROVACAO",observacoesAssinatura:a.observacoes},include:{cliente:{select:{nome:!0,email:!0}}}});return i.NextResponse.json({success:!0,message:"Assinatura processada com sucesso",proposta:{id:l.id,numeroProposta:l.numeroProposta,status:l.status,assinadoEm:l.assinadoEm,assinaturaTipo:l.assinaturaTipo,assinaturaNome:l.assinaturaNome}})}catch(e){if(e instanceof p.G)return i.NextResponse.json({error:"Dados inv\xe1lidos",details:e.issues},{status:400});return i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/propostas/[id]/assinatura/route",pathname:"/api/propostas/[id]/assinatura",filename:"route",bundlePath:"app/api/propostas/[id]/assinatura/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\propostas\\[id]\\assinatura\\route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:g,workUnitAsyncStorage:x,serverHooks:h}=m;function v(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:x})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33911:(e,t,s)=>{"use strict";s.d(t,{db:()=>n});class r{constructor(e){this.proposta={},this.propostaLog={},this.propostaEtapa={},this.propostaMaterial={},this.cliente={},this.usuario={}}$connect(){return Promise.resolve()}$disconnect(){return Promise.resolve()}$transaction(e){return e({})}generatePropostaNumber(){let e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),a=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return Promise.resolve(`PROP-${t}${s}${r}-${a}`)}}let a=globalThis;class o extends r{async generatePropostaNumber(){let e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),a=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return`PROP-${t}${s}${r}-${a}`}}let n=a.prisma??new o},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[7719,580,4501],()=>s(3815));module.exports=r})();