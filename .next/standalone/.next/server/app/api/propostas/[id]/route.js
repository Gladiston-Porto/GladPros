(()=>{var e={};e.id=4737,e.ids=[4737],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},26476:(e,t,r)=>{"use strict";r.d(t,{f6:()=>o,pQ:()=>a});var o=function(e){return e.RASCUNHO="RASCUNHO",e.ENVIADA="ENVIADA",e.ASSINADA="ASSINADA",e.APROVADA="APROVADA",e.CANCELADA="CANCELADA",e}({}),a=function(e){return e.CREATED="CREATED",e.UPDATED="UPDATED",e.SENT="SENT",e.SIGNED="SIGNED",e.APPROVED="APPROVED",e.CANCELLED="CANCELLED",e.ATTACH_ADDED="ATTACH_ADDED",e.ATTACH_REMOVED="ATTACH_REMOVED",e}({})},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33911:(e,t,r)=>{"use strict";r.d(t,{db:()=>n});class o{constructor(e){this.proposta={},this.propostaLog={},this.propostaEtapa={},this.propostaMaterial={},this.cliente={},this.usuario={}}$connect(){return Promise.resolve()}$disconnect(){return Promise.resolve()}$transaction(e){return e({})}generatePropostaNumber(){let e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),a=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return Promise.resolve(`PROP-${t}${r}${o}-${a}`)}}let a=globalThis;class s extends o{async generatePropostaNumber(){let e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),a=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return`PROP-${t}${r}${o}-${a}`}}let n=a.prisma??new s},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71166:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>D,routeModule:()=>A,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>E});var o={};r.r(o),r.d(o,{DELETE:()=>c,GET:()=>u,PUT:()=>l});var a=r(96559),s=r(48088),n=r(37719),i=r(32190),p=r(33911),d=r(26476);async function u(e,{params:t}){try{let{id:e}=t,r=await p.db.proposta.findFirst({where:{id:e,deletedAt:null},include:{cliente:{select:{id:!0,nomeCompleto:!0,razaoSocial:!0,email:!0}},etapas:{orderBy:{ordem:"asc"}},materiais:{orderBy:{nome:"asc"}},anexos:{orderBy:{createdAt:"desc"}},logs:{include:{usuario:{select:{id:!0,nome:!0,email:!0}}},orderBy:{createdAt:"desc"}},projeto:{include:{cliente:{select:{id:!0,nomeCompleto:!0,razaoSocial:!0}}}}}});if(!r)return i.NextResponse.json({error:"Proposta n\xe3o encontrada"},{status:404});let o={...r,cliente:r.cliente?{id:r.cliente.id,nome:r.cliente.nomeCompleto||r.cliente.razaoSocial||"Cliente",email:r.cliente.email}:null};return i.NextResponse.json(o)}catch(e){return console.error("Error fetching proposta:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function l(e,{params:t}){try{let{id:r}=t,o=await e.json(),a=await p.db.proposta.findFirst({where:{id:r,deletedAt:null}});if(!a)return i.NextResponse.json({error:"Proposta n\xe3o encontrada"},{status:404});if(a.status!==d.f6.RASCUNHO)return i.NextResponse.json({error:"Proposta n\xe3o pode ser editada no status atual"},{status:400});let s=await p.db.$transaction(async t=>{let a=await t.proposta.update({where:{id:r},data:{...o,atualizadoEm:new Date},include:{cliente:{select:{id:!0,nomeCompleto:!0,razaoSocial:!0,email:!0}}}});return await t.propostaLog.create({data:{propostaId:r,usuarioId:"temp-user-id",acao:d.pQ.UPDATED,detalhes:`Proposta ${a.numeroProposta} atualizada`,ip:e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}),a}),n={...s,cliente:s.cliente?{id:s.cliente.id,nome:s.cliente.nomeCompleto||s.cliente.razaoSocial||"Cliente",email:s.cliente.email}:null};return i.NextResponse.json(n)}catch(e){return console.error("Error updating proposta:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function c(e,{params:t}){try{let{id:r}=t,o=await p.db.proposta.findFirst({where:{id:r,deletedAt:null}});if(!o)return i.NextResponse.json({error:"Proposta n\xe3o encontrada"},{status:404});if(o.status!==d.f6.RASCUNHO)return i.NextResponse.json({error:"Apenas propostas em rascunho podem ser exclu\xeddas"},{status:400});return await p.db.$transaction(async t=>{await t.proposta.update({where:{id:r},data:{deletedAt:new Date,atualizadoEm:new Date}}),await t.propostaLog.create({data:{propostaId:r,usuarioId:"temp-user-id",acao:d.pQ.CANCELLED,detalhes:`Proposta ${o.numeroProposta} exclu\xedda`,ip:e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}})}),i.NextResponse.json({message:"Proposta exclu\xedda com sucesso"})}catch(e){return console.error("Error deleting proposta:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let A=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/propostas/[id]/route",pathname:"/api/propostas/[id]",filename:"route",bundlePath:"app/api/propostas/[id]/route"},resolvedPagePath:"C:\\Users\\gladi\\Documents\\gladpros-nextjs\\src\\app\\api\\propostas\\[id]\\route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:m,workUnitAsyncStorage:E,serverHooks:g}=A;function D(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:E})}},78335:()=>{},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[7719,580],()=>r(71166));module.exports=o})();