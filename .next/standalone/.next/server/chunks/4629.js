exports.id=4629,exports.ids=[4629],exports.modules={7152:(e,o,t)=>{"use strict";t.d(o,{o0:()=>p,Bb:()=>f,a0:()=>v,pJ:()=>c});var a=t(24501),i=t(87624);function n(e){return i.qG(a.rS,e)}let r=/^(?:\+?\d[\d\s\-\(\)]{9,14})$/,l=/^(\d{5}|\d{5}-\d{3}|\d{5}-\d{4}|\d{8}|\d{5,9})$/,d=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,s=/^\d{3}-\d{2}-\d{4}$|^\d{9}$/,u=/^9\d{2}-\d{2}-\d{4}$|^9\d{8}$/,m=/^\d{2}-\d{7}$|^\d{9}$/,p=a.Ik({tipo:a.k5(["PF","PJ"],{message:"Tipo deve ser PF ou PJ"}),nomeCompleto:a.Yj().min(1,"Nome completo \xe9 obrigat\xf3rio").max(255).optional().nullable(),razaoSocial:a.Yj().max(255).optional().nullable(),nomeFantasia:a.Yj().max(255).optional().nullable(),email:a.Yj().min(1,"E-mail \xe9 obrigat\xf3rio").regex(d,"E-mail deve ter formato v\xe1lido").max(255),telefone:a.Yj().min(1,"Telefone \xe9 obrigat\xf3rio").regex(r,"Telefone deve ter formato v\xe1lido").transform(e=>e.replace(/\D/g,"")),tipoDocumentoPF:a.k5(["SSN","ITIN"]).optional().nullable(),ssn:a.vk(e=>""===e?void 0:e,a.Yj().regex(s,"SSN deve ter formato v\xe1lido (123-45-6789)").optional().nullable()),itin:a.vk(e=>""===e?void 0:e,a.Yj().regex(u,"ITIN deve ter formato v\xe1lido (9XX-XX-XXXX)").optional().nullable()),ein:a.vk(e=>""===e?void 0:e,a.Yj().regex(m,"EIN deve ter formato v\xe1lido (12-3456789)").optional().nullable()),endereco1:a.Yj().max(255).optional().nullable(),endereco2:a.Yj().max(255).optional().nullable(),cidade:a.Yj().max(96).optional().nullable(),estado:a.Yj().max(32).optional().nullable(),zipcode:a.vk(e=>""===e?void 0:e,a.Yj().regex(l,"CEP/ZIP deve ter formato v\xe1lido").transform(e=>e.replace(/\D/g,"")).optional().nullable()),observacoes:a.Yj().max(1e3).optional().nullable()}).refine(e=>"PF"===e.tipo?!!(e.nomeCompleto&&e.nomeCompleto.trim().length>0):"PJ"!==e.tipo||!!(e.nomeFantasia&&e.nomeFantasia.trim().length>0),{message:"Para PF o nome completo \xe9 obrigat\xf3rio, para PJ o nome da empresa \xe9 obrigat\xf3rio",path:["tipo"]}).refine(e=>{if("PF"===e.tipo&&e.tipoDocumentoPF){if("SSN"===e.tipoDocumentoPF&&e.ssn)return/^\d{3}-\d{2}-\d{4}$|^\d{9}$/.test(e.ssn);if("ITIN"===e.tipoDocumentoPF&&e.itin)return/^9\d{2}-\d{2}-\d{4}$|^9\d{8}$/.test(e.itin)}return"PJ"!==e.tipo||!e.ein||/^\d{2}-\d{7}$|^\d{9}$/.test(e.ein)},{message:"Documentos devem ter formato v\xe1lido quando fornecidos",path:["tipo"]}),c=a.Ik({tipo:a.k5(["PF","PJ"]).optional(),ativo:a.zM().optional(),nomeCompleto:a.Yj().max(255).optional().nullable(),razaoSocial:a.Yj().max(255).optional().nullable(),nomeFantasia:a.Yj().max(255).optional().nullable(),email:a.Yj().regex(d,"E-mail deve ter formato v\xe1lido").max(255).optional(),telefone:a.Yj().regex(r,"Telefone deve ter formato v\xe1lido").optional(),tipoDocumentoPF:a.k5(["SSN","ITIN"]).optional().nullable(),ssn:a.vk(e=>""===e?void 0:e,a.Yj().regex(s,"SSN deve ter formato v\xe1lido (123-45-6789)").optional().nullable()),itin:a.vk(e=>""===e?void 0:e,a.Yj().regex(u,"ITIN deve ter formato v\xe1lido (9XX-XX-XXXX)").optional().nullable()),ein:a.vk(e=>""===e?void 0:e,a.Yj().regex(m,"EIN deve ter formato v\xe1lido (12-3456789)").optional().nullable()),endereco1:a.Yj().max(255).optional().nullable(),endereco2:a.Yj().max(255).optional().nullable(),cidade:a.Yj().max(96).optional().nullable(),estado:a.Yj().max(32).optional().nullable(),zipcode:a.vk(e=>""===e?void 0:e,a.Yj().regex(l,"CEP/ZIP deve ter formato v\xe1lido").transform(e=>e.replace(/\D/g,"")).optional().nullable()),observacoes:a.Yj().max(1e3).optional().nullable()}).refine(e=>"PF"===e.tipo&&void 0!==e.nomeCompleto?!e.nomeCompleto||e.nomeCompleto.trim().length>0:"PJ"!==e.tipo||void 0===e.nomeFantasia||!e.nomeFantasia||e.nomeFantasia.trim().length>0,{message:"Nome completo (PF) ou nome da empresa (PJ) n\xe3o podem ser vazios se fornecidos",path:["tipo"]}).refine(e=>{if("PF"===e.tipo&&e.tipoDocumentoPF){if("SSN"===e.tipoDocumentoPF&&void 0!==e.ssn)return!e.ssn||/^\d{3}-\d{2}-\d{4}$|^\d{9}$/.test(e.ssn);if("ITIN"===e.tipoDocumentoPF&&void 0!==e.itin)return!e.itin||/^9\d{2}-\d{2}-\d{4}$|^9\d{8}$/.test(e.itin)}return"PJ"!==e.tipo||void 0===e.ein||!e.ein||/^\d{2}-\d{7}$|^\d{9}$/.test(e.ein)},{message:"Documentos devem ter formato v\xe1lido",path:["tipo"]}).transform(e=>{if(void 0!==e.telefone){if(""===e.telefone||null===e.telefone)e.telefone=void 0;else if(e.telefone=String(e.telefone).replace(/\D/g,""),!/^\d{7,15}$/.test(e.telefone))throw Error("Telefone deve ter entre 7 e 15 d\xedgitos")}return e}),f=a.Ik({q:a.Yj().optional(),tipo:a.k5(["PF","PJ","all"]).optional().default("all"),ativo:a.vk(e=>"true"===e||"false"!==e&&e,a.KC([a.zM(),a.eu("all")])).optional().default("all"),page:n().min(1).optional().default(1),pageSize:n().min(1).max(2e3).optional().default(10),sortKey:a.k5(["nome","tipo","email","telefone","documento","cidadeEstado","status"]).optional(),sortDir:a.k5(["asc","desc"]).optional()}),v=a.Ik({id:n().int().positive()}),E=a.Ik({id:a.ai(),tipo:a.k5(["PF","PJ"]),nomeCompletoOuRazao:a.Yj(),email:a.Yj(),telefone:a.Yj(),cidade:a.Yj().nullable(),estado:a.Yj().nullable(),zipcode:a.Yj().nullable(),documentoMasked:a.Yj(),ativo:a.zM(),criadoEm:a.Yj(),atualizadoEm:a.Yj()});a.Ik({data:a.YO(E),page:a.ai(),pageSize:a.ai(),total:a.ai(),totalPages:a.ai()})},13641:(e,o,t)=>{"use strict";t.d(o,{z:()=>a.z});var a=t(31183)},18260:(e,o,t)=>{"use strict";t.d(o,{d:()=>i});var a=t(13641);class i{static async logAction(e,o,t,i,n){try{let r=a.z?.auditLog;if(!r||"function"!=typeof r.create)return null;return await r.create({data:{userId:e,entidade:o,entidadeId:t.toString(),acao:i,diff:n?JSON.stringify(n):null,timestamp:new Date}})}catch{return console.error("Erro ao registrar audit log:"),null}}static async getEntityHistory(e,o,t=50){try{let i=a.z?.auditLog;if(!i||"function"!=typeof i.findMany)return[];return await i.findMany({where:{entidade:e,entidadeId:o.toString()},include:{usuario:{select:{id:!0,nomeCompleto:!0,email:!0}}},orderBy:{timestamp:"desc"},take:t})}catch{return console.error("Erro ao buscar hist\xf3rico:"),[]}}}},29979:(e,o,t)=>{"use strict";t.d(o,{I:()=>r});var a=t(13641);let i=null,n=0;async function r(){let e=Date.now();if(null!==i&&e-n<6e4)return i;try{let o=await a.z.$queryRaw`
      SELECT COUNT(*) AS cnt
      FROM INFORMATION_SCHEMA.COLUMNS
      WHERE TABLE_SCHEMA = DATABASE()
        AND TABLE_NAME = 'Usuario'
        AND COLUMN_NAME = 'tokenVersion'
    `;return i=(o?.[0]?.cnt??0)>0,n=e,i}catch{return i=!1,n=e,!1}}},31183:(e,o,t)=>{"use strict";t.d(o,{z:()=>i});var a=t(29942);let i=global.__prisma??new a.PrismaClient({log:["error"]})},48378:(e,o,t)=>{"use strict";t.d(o,{S:()=>d,z:()=>l});var a=t(87806),i=t(77412);let n=null;function r(){if(!n){let e="g5QZk5uXmGBy1267sLdrd8FHIzUqEtUrxnyJqoWYEqPklmXS1YiLp0ervYW7C017";if(e){if(e.length<32)throw Error("JWT_SECRET deve ter pelo menos 32 caracteres");n=new TextEncoder().encode(e)}else if("phase-production-build"===process.env.NEXT_PHASE||"phase-production-server"===process.env.NEXT_PHASE||"phase-static"===process.env.NEXT_PHASE||"phase-export"===process.env.NEXT_PHASE||"phase-development-build"===process.env.NEXT_PHASE)console.warn("[JWT] Usando secret tempor\xe1rio durante build. Certifique-se de definir JWT_SECRET em produ\xe7\xe3o."),n=new TextEncoder().encode("temporary-build-secret-will-be-replaced-at-runtime-32-chars-minimum");else throw Error("Missing JWT_SECRET environment variable. Certifique-se de definir esta vari\xe1vel em .env.local")}return n}async function l(e,o="7d"){return await new a.P({role:e.role,status:e.status,tokenVersion:e.tokenVersion}).setProtectedHeader({alg:"HS256"}).setSubject(e.sub).setIssuer("gladpros").setAudience("gladpros-app").setExpirationTime(o).sign(r())}async function d(e){let{payload:o}=await (0,i.V)(e,r(),{issuer:"gladpros",audience:"gladpros-app"});return o}},78335:()=>{},80969:(e,o,t)=>{"use strict";t.d(o,{nS:()=>m,lE:()=>p,JR:()=>u});var a=t(48378),i=t(13641),n=t(29979);let r=["read","create","update","delete"],l=["read"],d=[];function s(e,o){return o.includes(e)}async function u(e){let o=e?.headers?.get?.("cookie")??"",t=o.split(/;\s*/).map(e=>e.split("=")).find(e=>"authToken"===e[0])?.[1]?decodeURIComponent(o.split(/;\s*/).map(e=>e.split("=")).find(e=>"authToken"===e[0])[1]):void 0;if(!t)throw Error("UNAUTHENTICATED");let r=await (0,a.S)(t);if(await (0,n.I)())try{let e=await i.z.$queryRaw`
        SELECT tokenVersion FROM Usuario WHERE id = ${Number(r.sub)} LIMIT 1
      `,o=e[0]?.tokenVersion??0;if((r.tokenVersion??0)!==o)throw Error("UNAUTHENTICATED")}catch{}return{id:r.sub,role:String(r.role),status:r.status??"ATIVO",email:r?.email,nome:r?.nome}}let m={canRead:e=>s(e,["ADMIN","GERENTE","USUARIO"]),canCreate:e=>s(e,["ADMIN","GERENTE"]),canUpdate:e=>s(e,["ADMIN","GERENTE"]),canDelete:e=>s(e,["ADMIN"]),canViewDocuments:e=>s(e,["ADMIN","GERENTE"])};async function p(e,o){let t=await u(e);if(!m[o](t.role))throw Error("FORBIDDEN");return t}},96487:()=>{}};